<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Linear regression in R | Workshop 4: Linear models</title>
  <meta name="description" content="Linear models" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Linear regression in R | Workshop 4: Linear models" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops//assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Linear models" />
  <meta name="github-repo" content="qcbsRworkshops/workshop04" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Linear regression in R | Workshop 4: Linear models" />
  
  <meta name="twitter:description" content="Linear models" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops//assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="the-linear-model.html"/>
<link rel="next" href="t-test-and-anova.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a>
<ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Linear models in <code>R</code></b></span></li>
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning objectives</a></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="chapter" data-level="3" data-path="the-linear-model.html"><a href="the-linear-model.html"><i class="fa fa-check"></i><b>3</b> The linear model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-linear-model.html"><a href="the-linear-model.html#what-is-a-linear-model"><i class="fa fa-check"></i><b>3.1</b> What is a linear model?</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="the-linear-model.html"><a href="the-linear-model.html#example-abundance-and-mass-of-bird-species"><i class="fa fa-check"></i><b>3.1.1</b> Example: Abundance and mass of bird species</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-linear-model.html"><a href="the-linear-model.html#formulation-of-a-linear-model"><i class="fa fa-check"></i><b>3.2</b> Formulation of a linear model</a></li>
<li class="chapter" data-level="3.3" data-path="the-linear-model.html"><a href="the-linear-model.html#evaluation-of-the-linear-model"><i class="fa fa-check"></i><b>3.3</b> Evaluation of the linear model</a></li>
<li class="chapter" data-level="3.4" data-path="the-linear-model.html"><a href="the-linear-model.html#assumptions-of-the-linear-model"><i class="fa fa-check"></i><b>3.4</b> Assumptions of the linear model</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="the-linear-model.html"><a href="the-linear-model.html#normal-distribution-of-the-residuals"><i class="fa fa-check"></i><b>3.4.1</b> Normal distribution of the residuals</a></li>
<li class="chapter" data-level="3.4.2" data-path="the-linear-model.html"><a href="the-linear-model.html#homoscedasticity"><i class="fa fa-check"></i><b>3.4.2</b> Homoscedasticity</a></li>
<li class="chapter" data-level="3.4.3" data-path="the-linear-model.html"><a href="the-linear-model.html#independence-of-the-residuals"><i class="fa fa-check"></i><b>3.4.3</b> Independence of the residuals</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-linear-model.html"><a href="the-linear-model.html#notation-for-linear-models"><i class="fa fa-check"></i><b>3.5</b> Notation for linear models</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="the-linear-model.html"><a href="the-linear-model.html#mathematical-notation"><i class="fa fa-check"></i><b>3.5.1</b> Mathematical notation</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-linear-model.html"><a href="the-linear-model.html#r-notation"><i class="fa fa-check"></i><b>3.5.2</b> R notation</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="the-linear-model.html"><a href="the-linear-model.html#fitting-a-linear-model"><i class="fa fa-check"></i><b>3.6</b> Fitting a linear model</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="the-linear-model.html"><a href="the-linear-model.html#model-estimation"><i class="fa fa-check"></i><b>3.6.1</b> Model estimation</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="the-linear-model.html"><a href="the-linear-model.html#learning-objectives-1"><i class="fa fa-check"></i><b>3.7</b> Learning objectives</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html"><i class="fa fa-check"></i><b>4</b> Linear regression in R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#model-formulation"><i class="fa fa-check"></i><b>4.1</b> Model formulation</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#model-equation"><i class="fa fa-check"></i><b>4.1.1</b> Model equation</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#linear-regression-in-r-1"><i class="fa fa-check"></i><b>4.2</b> Linear regression in R</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#step-1-formulate-and-run-a-linear-model"><i class="fa fa-check"></i><b>4.2.1</b> Step 1: Formulate and run a linear model</a></li>
<li class="chapter" data-level="4.2.2" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#step-2-verify-assumptions-using-diagnostic-plots-of-the-residuals"><i class="fa fa-check"></i><b>4.2.2</b> Step 2: Verify assumptions using diagnostic plots of the residuals</a></li>
<li class="chapter" data-level="4.2.3" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#step-2.-verify-assumptions-of-lm1"><i class="fa fa-check"></i><b>4.2.3</b> <strong>Step 2</strong>. Verify assumptions of <code>lm1</code></a></li>
<li class="chapter" data-level="4.2.4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#assumptions-not-met---what-is-wrong"><i class="fa fa-check"></i><b>4.2.4</b> Assumptions not met - what is wrong?</a></li>
<li class="chapter" data-level="4.2.5" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#assumptions-not-met---how-to-proceed"><i class="fa fa-check"></i><b>4.2.5</b> Assumptions not met - how to proceed?</a></li>
<li class="chapter" data-level="4.2.6" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#step-3.-analyze-parameter-estimates"><i class="fa fa-check"></i><b>4.2.6</b> <strong>Step 3.</strong> Analyze parameter estimates</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#model-interpretation"><i class="fa fa-check"></i><b>4.3</b> Model interpretation</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#finding-a-better-model-terrestrial-birds"><i class="fa fa-check"></i><b>4.3.1</b> Finding a better model: terrestrial birds</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#challenge-2"><i class="fa fa-check"></i><b>4.4</b> Challenge 2</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#solutions"><i class="fa fa-check"></i><b>4.4.1</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#linear-regression-in-r-2"><i class="fa fa-check"></i><b>4.5</b> Linear regression in R</a></li>
<li class="chapter" data-level="4.6" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#variable-names"><i class="fa fa-check"></i><b>4.6</b> Variable names</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html"><i class="fa fa-check"></i><b>5</b> t-test and ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#analysis-of-variance-anova"><i class="fa fa-check"></i><b>5.1</b> Analysis of Variance (ANOVA)</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#types-of-anova"><i class="fa fa-check"></i><b>5.1.1</b> Types of ANOVA</a></li>
<li class="chapter" data-level="5.1.2" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#t-test"><i class="fa fa-check"></i><b>5.1.2</b> T-test</a></li>
<li class="chapter" data-level="5.1.3" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#running-an-anova"><i class="fa fa-check"></i><b>5.1.3</b> Running an ANOVA</a></li>
<li class="chapter" data-level="5.1.4" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#verifying-assumptions"><i class="fa fa-check"></i><b>5.1.4</b> Verifying assumptions</a></li>
<li class="chapter" data-level="5.1.5" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#model-output"><i class="fa fa-check"></i><b>5.1.5</b> Model output</a></li>
<li class="chapter" data-level="5.1.6" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#complementary-test"><i class="fa fa-check"></i><b>5.1.6</b> Complementary test</a></li>
<li class="chapter" data-level="5.1.7" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#plotting"><i class="fa fa-check"></i><b>5.1.7</b> Plotting</a></li>
<li class="chapter" data-level="5.1.8" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#going-further-contrasts"><i class="fa fa-check"></i><b>5.1.8</b> Going further: Contrasts</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#two-way-anova"><i class="fa fa-check"></i><b>5.2</b> Two-way ANOVA</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#running-a-two-way-anova"><i class="fa fa-check"></i><b>5.2.1</b> 4.1 Running a two-way ANOVA</a></li>
<li class="chapter" data-level="5.2.2" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#interaction-plot"><i class="fa fa-check"></i><b>5.2.2</b> 4.2 Interaction plot</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#unbalanced-anova-advanced-section-optional"><i class="fa fa-check"></i><b>5.3</b> Unbalanced ANOVA (advanced section/ optional)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analysis-of-covariance-ancova.html"><a href="analysis-of-covariance-ancova.html"><i class="fa fa-check"></i><b>6</b> Analysis of covariance (ANCOVA)</a>
<ul>
<li class="chapter" data-level="6.0.1" data-path="analysis-of-covariance-ancova.html"><a href="analysis-of-covariance-ancova.html#assumptions-1"><i class="fa fa-check"></i><b>6.0.1</b> 6.1 Assumptions</a></li>
<li class="chapter" data-level="6.0.2" data-path="analysis-of-covariance-ancova.html"><a href="analysis-of-covariance-ancova.html#types-of-ancova"><i class="fa fa-check"></i><b>6.0.2</b> 6.2 Types of ANCOVA</a></li>
<li class="chapter" data-level="6.0.3" data-path="analysis-of-covariance-ancova.html"><a href="analysis-of-covariance-ancova.html#running-an-ancova"><i class="fa fa-check"></i><b>6.0.3</b> 6.3 Running an ANCOVA</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html"><i class="fa fa-check"></i><b>7</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="7.0.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#model-formulation-1"><i class="fa fa-check"></i><b>7.0.1</b> Model formulation</a></li>
<li class="chapter" data-level="7.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#assumptions-2"><i class="fa fa-check"></i><b>7.1</b> Assumptions</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#if-variables-are-collinear"><i class="fa fa-check"></i><b>7.1.1</b> If variables are collinear</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#multiple-linear-regression-in-r"><i class="fa fa-check"></i><b>7.2</b> Multiple linear regression in R</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#the-data"><i class="fa fa-check"></i><b>7.2.1</b> The data</a></li>
<li class="chapter" data-level="7.2.2" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#verify-assumptions"><i class="fa fa-check"></i><b>7.2.2</b> Verify assumptions</a></li>
<li class="chapter" data-level="7.2.3" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#linear-regression"><i class="fa fa-check"></i><b>7.2.3</b> Linear regression</a></li>
<li class="chapter" data-level="7.2.4" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#find-the-best-fit-model"><i class="fa fa-check"></i><b>7.2.4</b> Find the best-fit model</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#polynomial-regression-additional-material"><i class="fa fa-check"></i><b>7.3</b> Polynomial regression (additional material)</a></li>
<li class="chapter" data-level="7.4" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#variation-partitioning-additional-material"><i class="fa fa-check"></i><b>7.4</b> Variation Partitioning (additional material)</a></li>
</ul></li>
<li class="part"><span><b>Final considerations</b></span></li>
<li class="chapter" data-level="8" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>8</b> Summary</a></li>
<li class="chapter" data-level="9" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i><b>9</b> Additional resources</a></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 4: Linear models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>


<!-- 
<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
--!>
<div id="linear-regression-in-r" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Linear regression in R<a href="linear-regression-in-r.html#linear-regression-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the following example, we will take the bird abundance and mass data and run a linear regression in R. Based on the hypothesis, we will formulate an equation that allows us to run the model and then check the assumptions under which the model can be run. We will also see how to interpret the output of the model and how to represent it graphically.</p>
<div id="model-formulation" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Model formulation<a href="linear-regression-in-r.html#model-formulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<p>The data are composed of the average mass of individuals of a species and the abundance of those species. We are interested in quantifying the relationship between the mass of an individual and the abundance of the species (or the effect of mass on abundance).</p>
<p>We hypothesized that for different bird species, the <strong>average mass of an individual has an effect on the maximum abundance</strong> of the species, due to ecological constraints (food sources, habitat availability, etc.).</p>
<div id="model-equation" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Model equation<a href="linear-regression-in-r.html#model-equation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In mathematical notation, a linear model takes the form of the equation of a line for which the predicted variable is the maximum abundance “MaxAbund” and the predictor variable is the mass of individuals “Mass”.</p>
<p><span class="math display">\[\textrm{MaxAbund}_i = \beta_0 + \beta_1 \times \textrm{Mass}_i + \epsilon_i \;, \quad \epsilon_i \sim \mathcal{N}(0, \sigma^2)\]</span></p>
<blockquote>
<p>Note that the linear model has three variables: <span class="math inline">\(\beta_0\)</span> , <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\sigma^1\)</span>. <span class="math inline">\(\sigma^1\)</span> defines the variance of the data around the model and is a variable of the normal distribution that describes the distribution of the data around the model (on either side of our line).</p>
</blockquote>
<p><strong>Model formula in R</strong></p>
<p>In the R programming language, the equation is translated as :</p>
<pre><code>MaxAbund ~ Mass</code></pre>
<p>where the predicted variable is placed on the left of the tilde and the predictor variable is on the right.</p>
</div>
</div>
<div id="linear-regression-in-r-1" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Linear regression in R<a href="linear-regression-in-r.html#linear-regression-in-r-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<p>Performing a linear regression with R is divided into three steps:</p>
<ol style="list-style-type: decimal">
<li>Formulate and run a linear model based on a hypothesis</li>
<li>Check the conditions for the linear model</li>
<li>Examine the output of the model and whether the conditions are met
<ul>
<li>Analyze the regression parameters</li>
<li>Plot the model</li>
<li>Perform significance tests on the parameter estimates (if necessary)</li>
</ul></li>
</ol>
<p>We will explore each step in the following sections.</p>
<p>Also, in the case where the conditions are not met, we will see that it is possible to consider the use of a <em>Generalized Linear Model</em> (GLM) or the transformation of the data.</p>
<div id="step-1-formulate-and-run-a-linear-model" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Step 1: Formulate and run a linear model<a href="linear-regression-in-r.html#step-1-formulate-and-run-a-linear-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>lm()</code> command is used to fit a linear model where the first argument is the model formula:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="linear-regression-in-r.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression of maximum abundance against mass</span></span>
<span id="cb18-2"><a href="linear-regression-in-r.html#cb18-2" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(MaxAbund <span class="sc">~</span> Mass, <span class="at">data =</span> bird)</span></code></pre></div>
<p>With this line of code, we define a new <code>lm1</code> object that contains the linear model. We also specify two arguments to the function. The first <code>MaxAbund ~ Mass</code> is the model formula and the second <code>bird</code> defines the object that contains the variables.</p>
<blockquote>
<p>Before using a new function in R, you should refer to its help page (<code>?functionname</code>) to understand how to use the function and the default parameters.</p>
</blockquote>
<p>Let’s look at the parameter estimates:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="linear-regression-in-r.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examination of the regression output</span></span>
<span id="cb19-2"><a href="linear-regression-in-r.html#cb19-2" aria-hidden="true" tabindex="-1"></a>lm1</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = MaxAbund ~ Mass, data = bird)
## 
## Coefficients:
## (Intercept)         Mass  
##    38.16646      0.01439</code></pre>
<p>How do the parameters compare to our predictions? You will notice that the parameter for mass is positive while we predicted a negative relationship (<em>Species characterized by larger individuals have lower maximum abundance</em>).</p>
<p>However, can we trust the estimates? To be sure, we need to check the application conditions!</p>
</div>
<div id="step-2-verify-assumptions-using-diagnostic-plots-of-the-residuals" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Step 2: Verify assumptions using diagnostic plots of the residuals<a href="linear-regression-in-r.html#step-2-verify-assumptions-using-diagnostic-plots-of-the-residuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An effective method of verifying that the model’s assumptions are met is to conduct a visual examination. Four diagnostic plots can be produced from an <code>lm</code> object. To do this, we use these commands:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="linear-regression-in-r.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the four diagnostic plots</span></span>
<span id="cb21-2"><a href="linear-regression-in-r.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb21-3"><a href="linear-regression-in-r.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm1)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-17-1.png" width="528" /></p>
<p><code>par()</code> is a function that allows you to define the parameters of the graph. Here we specify <code>mfrow=c(2,2)</code> which displays a grid of 2 x 2 graphs at a time. Finally, <code>plot()</code> produces the graphics.</p>
<blockquote>
<p>To display only one plot at a time, we can specify <code>par(mfrow=1)</code>.</p>
</blockquote>
<div id="diagnostic-plot-1---residuals-vs-fitted" class="section level4 hasAnchor" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> Diagnostic plot # 1 - Residuals vs Fitted<a href="linear-regression-in-r.html#diagnostic-plot-1---residuals-vs-fitted" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The first plot informs us of the distribution of the residuals according to the values predicted by the linear regression model. Each point represents the distance between the response variable and the model prediction. It informs us about the <em>independence</em> of the residuals and their <em>distribution</em>. Remember that with linear regression, we need a uniform distribution of the residuals (the <em>homoscedasticity</em> condition).</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-18-1.png" width="624" /></p>
<p>On the <strong>y</strong> axis we find the residuals <span class="math inline">\(\epsilon_i\)</span> and on the <strong>x</strong> axis the predicted values <span class="math inline">\(\hat{y_i} = \beta_0 + \beta_1 \times x_i\)</span>.</p>
<p>In an ideal situation, there is no pattern to the dispersion of the points.</p>
<ul>
<li>If the residuals are scattered <strong>randomly around the line of 0</strong>, the relationship is linear and the mean of the residuals is 0.</li>
<li>If the residuals form an approximate <strong>horizontal band</strong> around the 0 line, the variance of the residuals is homogeneous (i.e. they are homoscedastic).</li>
<li>If the residuals are organized in a <strong>funnel shape</strong>, the residuals are not homoscedastic.</li>
</ul>
<hr />
<p><strong>Warning!</strong> You should be alerted if the distribution of the points is non-linear as in these two examples:</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-19-1.png" width="816" /></p>
<p>These examples present a non-linear relationship and an example of heteroscedasticity which is the opposite of homoscedasticity, meaning that the normality condition is not met.</p>
<p>In this situation, one should rather use a <strong>generalized linear model</strong> (GLM) that allows for other distributions (Poisson, binomial, negative binomial, etc.) or try to <strong>transform</strong> the response variable and/or the predictors.</p>
<hr />
</div>
<div id="diagnostic-plot-2---scale-location" class="section level4 hasAnchor" number="4.2.2.2">
<h4><span class="header-section-number">4.2.2.2</span> Diagnostic plot # 2 - Scale Location<a href="linear-regression-in-r.html#diagnostic-plot-2---scale-location" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The second diagnostic graph allows us to check if the <em>dispersion of the residuals</em> is increasing for a given predicted value (i.e. if the dispersion of the residuals is caused by the explanatory variable). If the dispersion increases, the basic condition of homoscedasticity is not respected.</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-20-1.png" width="576" /></p>
<p>On the <strong>y</strong> axis we find the square root of the standardized residuals <span class="math inline">\(\sqrt{\frac{\epsilon_i}{\sigma}}\)</span> and on the <strong>x</strong> axis the predicted values <span class="math inline">\(\hat{y_i} = \beta_0 + \beta_1 \times x_i\)</span>.</p>
<p>Here we are also looking for a dispersion of the points without a pattern, thus an evenly distributed predictor.</p>
<hr />
<p><strong>Caution!</strong> Be careful if the distribution of the points shows a marked trend:</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-21-1.png" width="576" /></p>
<p>In a situation like this, we cannot rely on model results and should instead try to use a <strong>generalized linear model</strong> (GLM) that allows for other distributions (Poisson, binomial, negative binomial, etc.) or <strong>transform</strong> the response variable and/or the predictors.</p>
<hr />
</div>
<div id="diagnostic-plot-3---normal-qq" class="section level4 hasAnchor" number="4.2.2.3">
<h4><span class="header-section-number">4.2.2.3</span> Diagnostic plot # 3 - Normal QQ<a href="linear-regression-in-r.html#diagnostic-plot-3---normal-qq" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The third plot shows the distribution of the residuals. With this quantile-quantile plot, we can evaluate the normality of the residuals. This plot compares the probability distribution of the residuals of the model to a probability distribution of normal data.</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-22-1.png" width="576" /></p>
<p>On the <strong>y</strong> axis we find the standardized residuals <span class="math inline">\(\frac{epsilon_i}{\sigma}\)</span> and on the <strong>x</strong> axis the quantiles of a standard normal distribution <span class="math inline">\(\mathcal{N}(0, \sigma^2)\)</span>.</p>
<p>We want to see the standardized residuals are near the 1:1 line. Thus, the residuals can be considered normally distributed.</p>
<hr />
<p><strong>Caution!</strong> Be suspicious if the distribution of the points does not follow the 1:1 line:</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-23-1.png" width="576" /></p>
<p>In this case, the points are not well aligned on the line, suggesting that the residuals are not normally distributed. Instead, try using a <strong>generalized linear model</strong> (GLM) that allows for other distributions (Poisson, binomial, negative binomial, etc.) or <strong>transform</strong> the response variable and/or the predictors.</p>
<hr />
</div>
<div id="diagnostic-plot-4---residuals-vs-leverage" class="section level4 hasAnchor" number="4.2.2.4">
<h4><span class="header-section-number">4.2.2.4</span> Diagnostic plot # 4 - Residuals vs Leverage<a href="linear-regression-in-r.html#diagnostic-plot-4---residuals-vs-leverage" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This last diagnostic plot shows the residuals and their influence. It allows us to determine if certain observations have a strong influence. Although we are not testing for a baseline condition, the presence of points with a strong influence can influence our interpretation of the data. If one or more observations are outliers (i.e., if they have very different values from the others), the model may be misfitted because of their exaggerated influence on the model estimate.</p>
<p>The residuals vs. leverage plot shows the <em>leverage points</em> which are extreme observations of the predictor and their influence on the regression. The influence is quantified by the <em>Cook distance</em>. <strong>A distance greater than 0.5 is problematic</strong>.</p>
<p><strong>Example of leverage and influence</strong>.</p>
<p>These are not diagnostic plots, but figures that illustrate the concepts of leverage and influence.</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-24-1.png" width="720" /></p>
<p>We want to observe residuals that fall within the dotted lines marking the Cook distance of 0.5.</p>
<hr />
<p><strong>Caution!</strong> Beware if a point or points lie outside the dotted line:</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-25-1.png" width="768" /></p>
<p>The 29 has leverage and a Cook’s distance of more than 0.5. It corresponds to an outlier. However, outliers should never be removed without good reason to do so! If (and only if!) these observations are measurement errors or exceptions, they can be removed from the data set.</p>
<hr />
</div>
</div>
<div id="step-2.-verify-assumptions-of-lm1" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> <strong>Step 2</strong>. Verify assumptions of <code>lm1</code><a href="linear-regression-in-r.html#step-2.-verify-assumptions-of-lm1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Does <code>lm1</code> violate any assumptions of the linear model?</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-26-1.png" width="720" /></p>
<p>Based on the insights gained in the previous sections, there are serious problems with these diagnostic plots.
* Plots 1 and 2 shows strong trends,
* Plot 3 shows that the residuals do not follow a normal distribution,
* Plot 4 highlights the leverage of point 32 and its very high influence.</p>
<hr />
</div>
<div id="assumptions-not-met---what-is-wrong" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Assumptions not met - what is wrong?<a href="linear-regression-in-r.html#assumptions-not-met---what-is-wrong" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To understand the source of the problems with the linear model, let’s plot the model with the observations:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="linear-regression-in-r.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot linear model and observations</span></span>
<span id="cb22-2"><a href="linear-regression-in-r.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb22-3"><a href="linear-regression-in-r.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lm1)  <span class="co"># constant and slope</span></span></code></pre></div>
<pre><code>## (Intercept)        Mass 
## 38.16645523  0.01438562</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="linear-regression-in-r.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(MaxAbund <span class="sc">~</span> Mass, <span class="at">data =</span> bird)  <span class="co"># left plot</span></span>
<span id="cb24-2"><a href="linear-regression-in-r.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm1)  <span class="co"># line defined by the model parameters</span></span>
<span id="cb24-3"><a href="linear-regression-in-r.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(lm1))  <span class="co"># plot on the right : distribution of residuals</span></span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-27-1.png" width="1056" /></p>
<p>On the left we have the data as well as the line representing the model estimation (<code>MaxAbund ~ Mass</code>). On the left, the distribution of the residuals.</p>
<p>We can check if the residuals follow a normal distribution using a <em>Shapiro-Wilk</em> test and a skewness test (<em>skewness</em>):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="linear-regression-in-r.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the normality of residuals</span></span>
<span id="cb25-2"><a href="linear-regression-in-r.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(lm1))</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  residuals(lm1)
## W = 0.64158, p-value = 3.172e-10</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="linear-regression-in-r.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Skewness test</span></span>
<span id="cb27-2"><a href="linear-regression-in-r.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb27-3"><a href="linear-regression-in-r.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">skewness</span>(<span class="fu">residuals</span>(lm1))</span></code></pre></div>
<pre><code>## [1] 3.154719</code></pre>
<p>The Shapiro-Wilk test compares the distribution of the observed data to a normal distribution. The observed data can be considered normally distributed when the p-value calculated by the Shapiro-Wilk test is greater than the α significance level (usually 0.05). Here, the p-value (<code>p-value</code>) returned indicates a distribution that is significantly different from normal.</p>
<p>The skewness test measures the shift of the residuals. A positive value represents a leftward shift and a negative value a rightward shift. Here, the positive skewness value indicates that the distribution is left-shifted.</p>
<hr />
</div>
<div id="assumptions-not-met---how-to-proceed" class="section level3 hasAnchor" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Assumptions not met - how to proceed?<a href="linear-regression-in-r.html#assumptions-not-met---how-to-proceed" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Clearly, the assumptions of the linear model <code>lm1</code> are violated. Therefore, we cannot rely on the results of the model. We must turn to another alternative and there are two options when the assumptions of the linear model are violated.</p>
<p>**Use a different type of model</p>
<p>QCBS R Workshops 6-8 explore other models that may be a better fit for the hypothesis and data.</p>
<p><strong>Transform the data</strong></p>
<p>It is also possible to modify one’s data, whether it be the response variable or the predictors. Several types of transformations are possible and their usefulness depends on the distribution of the variable and the type of model. However, <strong>modifying variables is often tricky in practice</strong>. The transformation may <strong>solve some</strong> problems, but may <strong>create other</strong>.</p>
<blockquote>
<p>Note that <strong>results of statistical tests</strong> on transformed data <strong>do not automatically hold</strong> for the untransformed data.</p>
</blockquote>
<hr />
<div id="challenge-1-a-model-on-transformed-variables" class="section level4 hasAnchor" number="4.2.5.1">
<h4><span class="header-section-number">4.2.5.1</span> Challenge 1: A model on transformed variables<a href="linear-regression-in-r.html#challenge-1-a-model-on-transformed-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Our model has some serious problems. Let’s try a logarithmic transformation to see if it can correct the situation.</p>
<p>First, transform the data and run a new linear regression on it. Then, verify the assumptions of model using diagnostic plots.</p>
<p><strong>Step 1</strong></p>
<p>Let’s start by transforming the data in our dataset:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="linear-regression-in-r.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log-transform the variables</span></span>
<span id="cb29-2"><a href="linear-regression-in-r.html#cb29-2" aria-hidden="true" tabindex="-1"></a>bird<span class="sc">$</span>logMaxAbund <span class="ot">&lt;-</span> <span class="fu">log10</span>(bird<span class="sc">$</span>MaxAbund)</span>
<span id="cb29-3"><a href="linear-regression-in-r.html#cb29-3" aria-hidden="true" tabindex="-1"></a>bird<span class="sc">$</span>logMass <span class="ot">&lt;-</span> <span class="fu">log10</span>(bird<span class="sc">$</span>Mass)</span></code></pre></div>
<p>With these <code>logMaxAbund</code> and <code>logMass</code> data transformed, we run a new linear regression and save the model object as <code>lm2</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="linear-regression-in-r.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model with transformed data</span></span>
<span id="cb30-2"><a href="linear-regression-in-r.html#cb30-2" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logMaxAbund <span class="sc">~</span> logMass, <span class="at">data =</span> bird)</span></code></pre></div>
<p>We can observe that the parameters align with our prediction. That is, the <code>logMass</code> coefficient is negative and therefore the abundance decreases with the mass of the species. However, we still need to check the assumptions of the model to ensure the validity of the results.</p>
<p><strong>Step 2</strong></p>
<p>Let’s check the assumptions for <code>lm2</code> using the diagnostic plots.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="linear-regression-in-r.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic plots</span></span>
<span id="cb31-2"><a href="linear-regression-in-r.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="fl">1.15</span>, <span class="fl">1.2</span>))</span>
<span id="cb31-3"><a href="linear-regression-in-r.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm2)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-31-1.png" width="720" /></p>
<p>The diagnostic plots look much better, but there are still problems. Some plots still show strong trends. Let’s plot the model with the observations:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="linear-regression-in-r.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot linear model and observations</span></span>
<span id="cb32-2"><a href="linear-regression-in-r.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb32-3"><a href="linear-regression-in-r.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lm2)</span></code></pre></div>
<pre><code>## (Intercept)     logMass 
##   1.6723673  -0.2361498</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="linear-regression-in-r.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logMaxAbund <span class="sc">~</span> logMass, <span class="at">data =</span> bird)</span>
<span id="cb34-2"><a href="linear-regression-in-r.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm2)</span>
<span id="cb34-3"><a href="linear-regression-in-r.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(lm2))</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-32-1.png" width="1056" /></p>
<p>The model appears to explain the data better and the distribution of residuals has moved much closer to the normal distribution.</p>
<hr />
</div>
</div>
<div id="step-3.-analyze-parameter-estimates" class="section level3 hasAnchor" number="4.2.6">
<h3><span class="header-section-number">4.2.6</span> <strong>Step 3.</strong> Analyze parameter estimates<a href="linear-regression-in-r.html#step-3.-analyze-parameter-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The last step in a linear regression with R is to check the model parameters. We then use the <code>summary()</code> command to get more information about the fitted model.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="linear-regression-in-r.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print fitted model parameters</span></span>
<span id="cb35-2"><a href="linear-regression-in-r.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2)</span></code></pre></div>
<pre><code>
Call:
lm(formula = logMaxAbund ~ logMass, data = bird)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.93562 -0.39982  0.05487  0.40625  1.61469 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   1.6724     0.2472   6.767 1.17e-08 ***
logMass      -0.2361     0.1170  -2.019   0.0487 *  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.6959 on 52 degrees of freedom
Multiple R-squared:  0.07267,   Adjusted R-squared:  0.05484 
F-statistic: 4.075 on 1 and 52 DF,  p-value: 0.04869</code></pre>
<p>The output of <code>summary()</code> contains several values:
1. <code>Coefficients</code>: Estimates of the parameters and their standard deviation
2. <code>Pr(&gt;|t|)</code>: Results of a t-test to determine if the parameters are different from 0
3. <code>Adjusted R squared</code>: How well does the model explain the data?
4. <code>F-statistic</code>(ANOVA): Is the model significantly different from a model with no predictor (null model)?</p>
<p>We will discuss T-tests and ANOVA in the next section. However, we can already see that our model is only marginally better than the null model.</p>
<p>With the <code>lm2</code> object, we can also extract the parameters of the model and the other results:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="linear-regression-in-r.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectors of residuals and predicted values</span></span>
<span id="cb37-2"><a href="linear-regression-in-r.html#cb37-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lm2)</span>
<span id="cb37-3"><a href="linear-regression-in-r.html#cb37-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">fitted</span>(lm2)</span>
<span id="cb37-4"><a href="linear-regression-in-r.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(lm2)  <span class="co"># coefficients</span></span></code></pre></div>
<pre><code>## (Intercept)     logMass 
##   1.6723673  -0.2361498</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="linear-regression-in-r.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2)<span class="sc">$</span>coefficients  <span class="co"># coefficients and T-tests</span></span></code></pre></div>
<pre><code>##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept)  1.6723673  0.2471519  6.766557 1.166186e-08
## logMass     -0.2361498  0.1169836 -2.018658 4.869342e-02</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="linear-regression-in-r.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2)<span class="sc">$</span>adj.r.squared  <span class="co"># adjusted R squared</span></span></code></pre></div>
<pre><code>## [1] 0.05483696</code></pre>
</div>
</div>
<div id="model-interpretation" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Model interpretation<a href="linear-regression-in-r.html#model-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<p>Model interpretation is the final step when we obtain a model that meets the assumptions. Interpretation is the evaluation of the model’s support for the hypothesis. In short, we answer the question: <em>To what extent does the model support our hypothesis?</em></p>
<p><strong>Hypothesis</strong></p>
<blockquote>
<p>For different bird species, the <strong>average mass of an individual affects the maximum abundance</strong> of the species, due to ecological constraints (food sources, habitat availability, etc.).</p>
</blockquote>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="linear-regression-in-r.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the linear model with log-transformed data</span></span>
<span id="cb43-2"><a href="linear-regression-in-r.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2)</span></code></pre></div>
<pre><code>
Call:
lm(formula = logMaxAbund ~ logMass, data = bird)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.93562 -0.39982  0.05487  0.40625  1.61469 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   1.6724     0.2472   6.767 1.17e-08 ***
logMass      -0.2361     0.1170  -2.019   0.0487 *  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.6959 on 52 degrees of freedom
Multiple R-squared:  0.07267,   Adjusted R-squared:  0.05484 
F-statistic: 4.075 on 1 and 52 DF,  p-value: 0.04869</code></pre>
<p>The <code>lm2</code> model has very <strong>little evidence to support</strong> the hypothesis. Looking at the parameters of the model as discussed above, we observe that the model explains little of the response.</p>
<p>The low <code>Adjusted R squared</code> indicates that little of the variance in the response variable is explained by the model. Mass explains only a small fraction of the species abundance.</p>
<p>The <code>F-test</code> is barely significant indicating that the model is only slightly better than a model without predictor variables.</p>
<p>Finally, the estimated effect size (the coefficient) of the parameter <code>logMass</code> is very close to zero and is only marginally significant, i.e. an increase or decrease in species mass causes almost no change in their abundance.</p>
<p>The results are not as good as we would like, perhaps we should formulate a more precise hypothesis?</p>
<div id="finding-a-better-model-terrestrial-birds" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Finding a better model: terrestrial birds<a href="linear-regression-in-r.html#finding-a-better-model-terrestrial-birds" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let us formulate a new and more precise hypothesis. This time let’s focus only on land birds. Waterfowl abundance may not respond to mass in the same way as land birds.</p>
<p><strong>New hypothesis</strong></p>
<blockquote>
<p>For different bird species <span style="color:green"><strong>terrestrial</strong></span>, the <strong>average mass of an individual has an effect on the maximum abundance</strong> of the species, due to ecological constraints (food sources, habitat availability, etc.).</p>
</blockquote>
<p>We can now fit the linear model to exclude waterfowl:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="linear-regression-in-r.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model with terrestrial birds</span></span>
<span id="cb45-2"><a href="linear-regression-in-r.html#cb45-2" aria-hidden="true" tabindex="-1"></a>lm3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logMaxAbund <span class="sc">~</span> logMass, <span class="at">data =</span> bird, <span class="at">subset =</span> <span class="sc">!</span>bird<span class="sc">$</span>Aquatic)</span>
<span id="cb45-3"><a href="linear-regression-in-r.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># excludes waterfowls (!birdsAquatic == TRUE) or in an</span></span>
<span id="cb45-4"><a href="linear-regression-in-r.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># equivalent way: lm3 &lt;- lm(logMaxAbund~logMass, data=bird,</span></span>
<span id="cb45-5"><a href="linear-regression-in-r.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># subset=bird$Aquatic == 0)</span></span>
<span id="cb45-6"><a href="linear-regression-in-r.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="linear-regression-in-r.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Model output</span></span>
<span id="cb45-8"><a href="linear-regression-in-r.html#cb45-8" aria-hidden="true" tabindex="-1"></a>lm3</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logMaxAbund ~ logMass, data = bird, subset = !bird$Aquatic)
## 
## Coefficients:
## (Intercept)      logMass  
##      2.2701      -0.6429</code></pre>
<p><img src="book-en_files/figure-html/unnamed-chunk-37-1.png" width="720" /></p>
<p>From the diagnostic plots, we can conclude that the application conditions are met!</p>
<p>Finally, the model provides <strong>evidence to support</strong> our hypothesis:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="linear-regression-in-r.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm3)</span></code></pre></div>
<pre><code>
Call:
lm(formula = logMaxAbund ~ logMass, data = bird, subset = !bird$Aquatic)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.78289 -0.23135  0.04031  0.22932  1.68109 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.2701     0.2931   7.744 2.96e-09 ***
logMass      -0.6429     0.1746  -3.683 0.000733 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.6094 on 37 degrees of freedom
Multiple R-squared:  0.2682,    Adjusted R-squared:  0.2485 
F-statistic: 13.56 on 1 and 37 DF,  p-value: 0.000733</code></pre>
<p>The <code>Adjusted R-squared</code> is 0.25, indicating that the model is a reasonably good fit to the data. The model is much better than a model without predictor variables. The <code>F-test</code> is significant (&lt; 0.05). The <code>T-test</code> shows that the estimate of the parameter “logMass” is clearly different from 0 and that mass has an effect on species abundance.</p>
<hr />
</div>
</div>
<div id="challenge-2" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Challenge 2<a href="linear-regression-in-r.html#challenge-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the second challenge, let’s put all the steps together and try with new data:</p>
<ol style="list-style-type: decimal">
<li>Formulate another similar hypothesis about the maximum abundance and average mass of an individual, this time for passerine birds.</li>
<li>Fit a <strong>model</strong> to evaluate this hypothesis, using the transformed variables (i.e. <code>logMaxAbund</code> and <code>logMass</code>). Save the model as <code>lm4</code>.</li>
<li><strong>Verify assumptions</strong> of the linear model using the diagnostic plots.</li>
<li>Interpret the results: Does the model provide <strong>evidence to support the hypothesis</strong>?</li>
</ol>
<blockquote>
<p>Hint: Like aquatic species, passerines (variable <code>Passerine</code>) are coded 0/1 (check with <code>str(bird)</code>)</p>
</blockquote>
<div id="solutions" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Solutions<a href="linear-regression-in-r.html#solutions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Hypothesis</strong></p>
<blockquote>
<p>For different species of <span style="color:green"><strong>passers</strong></span>, the <strong>average mass of an individual affects the maximum abundance</strong> of the species, due to ecological constraints (food sources, habitat availability, etc.).</p>
</blockquote>
<p><strong>Fitting the model</strong></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="linear-regression-in-r.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting a linear model on passerine birds</span></span>
<span id="cb49-2"><a href="linear-regression-in-r.html#cb49-2" aria-hidden="true" tabindex="-1"></a>lm4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logMaxAbund <span class="sc">~</span> logMass, <span class="at">data =</span> bird, <span class="at">subset =</span> bird<span class="sc">$</span>Passerine <span class="sc">==</span></span>
<span id="cb49-3"><a href="linear-regression-in-r.html#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>)</span>
<span id="cb49-4"><a href="linear-regression-in-r.html#cb49-4" aria-hidden="true" tabindex="-1"></a>lm4</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logMaxAbund ~ logMass, data = bird, subset = bird$Passerine == 
##     1)
## 
## Coefficients:
## (Intercept)      logMass  
##      1.2429       0.2107</code></pre>
<p><strong>Verify assumptions of the linear model</strong></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="linear-regression-in-r.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb51-2"><a href="linear-regression-in-r.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm4)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-41-1.png" width="768" /></p>
<p><strong>Is it worth interpreting the results?</strong></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="linear-regression-in-r.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm4)</span></code></pre></div>
<pre><code>
Call:
lm(formula = logMaxAbund ~ logMass, data = bird, subset = bird$Passerine == 
    1)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.24644 -0.20937  0.02494  0.25192  0.93624 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)   1.2429     0.4163   2.985  0.00661 **
logMass       0.2107     0.3076   0.685  0.50010   
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.5151 on 23 degrees of freedom
Multiple R-squared:   0.02, Adjusted R-squared:  -0.02261 
F-statistic: 0.4694 on 1 and 23 DF,  p-value: 0.5001</code></pre>
<p>The results of the model should not be interpreted, because the assumptions of the linear model are not met!</p>
</div>
</div>
<div id="linear-regression-in-r-2" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Linear regression in R<a href="linear-regression-in-r.html#linear-regression-in-r-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<p>Performing a linear regression with R is divided into three steps:</p>
<ol style="list-style-type: decimal">
<li>Formulate and run a linear model based on a hypothesis</li>
<li>Check the assumptions for the linear model</li>
<li>Examine the output of the model and whether the conditions are met
<ul>
<li>Analyze the regression parameters</li>
<li>Plot the model</li>
<li>Perform significance tests on the parameter estimates (if necessary)</li>
</ul></li>
</ol>
<p>We will explore each step in the following sections.</p>
<p>Also, in the case where the assumptions are not met, we will see that it is possible to consider the use of a <em>Generalized Linear Model</em> (GLM) or data transformation.</p>
</div>
<div id="variable-names" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Variable names<a href="linear-regression-in-r.html#variable-names" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<p>Different terms are used for the <em>response</em> and the <em>predictor</em>, depending on the context and the scientific field. The terms are not always synonymous. Here are two tables to help you understand the jargon you will encounter.</p>
<table>
<thead>
<tr class="header">
<th align="left">response</th>
<th align="left">predictor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">explanatory var.</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">covariate</td>
</tr>
<tr class="odd">
<td align="left">outcome</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">output var.</td>
<td align="left">input var.</td>
</tr>
<tr class="odd">
<td align="left">dependent var.</td>
<td align="left">independent var.</td>
</tr>
</tbody>
</table>

</div>
</div>
<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="the-linear-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="t-test-and-anova.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
