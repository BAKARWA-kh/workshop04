<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 t-test and ANOVA | Workshop 4: Linear models</title>
  <meta name="description" content="Linear models" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 t-test and ANOVA | Workshop 4: Linear models" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/qcbsRworkshops/" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops//assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Linear models" />
  <meta name="github-repo" content="qcbsRworkshops/workshop04" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 t-test and ANOVA | Workshop 4: Linear models" />
  
  <meta name="twitter:description" content="Linear models" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops//assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="linear-regression-in-r.html"/>
<link rel="next" href="analysis-of-covariance-ancova.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Linear models in <code>R</code></b></span></li>
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning objectives</a></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="chapter" data-level="3" data-path="the-linear-model.html"><a href="the-linear-model.html"><i class="fa fa-check"></i><b>3</b> The linear model</a><ul>
<li class="chapter" data-level="3.1" data-path="the-linear-model.html"><a href="the-linear-model.html#what-is-a-linear-model"><i class="fa fa-check"></i><b>3.1</b> What is a linear model?</a><ul>
<li class="chapter" data-level="3.1.1" data-path="the-linear-model.html"><a href="the-linear-model.html#example-abundance-and-mass-of-bird-species"><i class="fa fa-check"></i><b>3.1.1</b> Example: Abundance and mass of bird species</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-linear-model.html"><a href="the-linear-model.html#formulation-of-a-linear-model"><i class="fa fa-check"></i><b>3.2</b> Formulation of a linear model</a></li>
<li class="chapter" data-level="3.3" data-path="the-linear-model.html"><a href="the-linear-model.html#evaluation-of-the-linear-model"><i class="fa fa-check"></i><b>3.3</b> Evaluation of the linear model</a></li>
<li class="chapter" data-level="3.4" data-path="the-linear-model.html"><a href="the-linear-model.html#assumptions-of-the-linear-model"><i class="fa fa-check"></i><b>3.4</b> Assumptions of the linear model</a><ul>
<li class="chapter" data-level="3.4.1" data-path="the-linear-model.html"><a href="the-linear-model.html#normal-distribution-of-the-residuals"><i class="fa fa-check"></i><b>3.4.1</b> Normal distribution of the residuals</a></li>
<li class="chapter" data-level="3.4.2" data-path="the-linear-model.html"><a href="the-linear-model.html#homoskedasticity"><i class="fa fa-check"></i><b>3.4.2</b> Homoskedasticity</a></li>
<li class="chapter" data-level="3.4.3" data-path="the-linear-model.html"><a href="the-linear-model.html#independence-of-the-residuals"><i class="fa fa-check"></i><b>3.4.3</b> Independence of the residuals</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-linear-model.html"><a href="the-linear-model.html#notation-for-linear-models"><i class="fa fa-check"></i><b>3.5</b> Notation for linear models</a><ul>
<li class="chapter" data-level="3.5.1" data-path="the-linear-model.html"><a href="the-linear-model.html#mathematical-notation"><i class="fa fa-check"></i><b>3.5.1</b> Mathematical notation</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-linear-model.html"><a href="the-linear-model.html#r-notation"><i class="fa fa-check"></i><b>3.5.2</b> R notation</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="the-linear-model.html"><a href="the-linear-model.html#fitting-a-linear-model"><i class="fa fa-check"></i><b>3.6</b> Fitting a linear model</a><ul>
<li class="chapter" data-level="3.6.1" data-path="the-linear-model.html"><a href="the-linear-model.html#model-estimation"><i class="fa fa-check"></i><b>3.6.1</b> Model estimation</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="the-linear-model.html"><a href="the-linear-model.html#learning-objectives-1"><i class="fa fa-check"></i><b>3.7</b> Learning objectives</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html"><i class="fa fa-check"></i><b>4</b> Linear regression in R</a><ul>
<li class="chapter" data-level="4.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#model-formulation"><i class="fa fa-check"></i><b>4.1</b> Model formulation</a><ul>
<li class="chapter" data-level="4.1.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#model-equation"><i class="fa fa-check"></i><b>4.1.1</b> Model equation</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#linear-regression-in-r-1"><i class="fa fa-check"></i><b>4.2</b> Linear regression in R</a><ul>
<li class="chapter" data-level="4.2.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#step-1-formulate-and-run-a-linear-model"><i class="fa fa-check"></i><b>4.2.1</b> Step 1: Formulate and run a linear model</a></li>
<li class="chapter" data-level="4.2.2" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#step-2-verify-assumptions-using-diagnostic-plots-of-the-residuals"><i class="fa fa-check"></i><b>4.2.2</b> Step 2: Verify assumptions using diagnostic plots of the residuals</a></li>
<li class="chapter" data-level="4.2.3" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#step-2.-verify-assumptions-of-lm1"><i class="fa fa-check"></i><b>4.2.3</b> <strong>Step 2</strong>. Verify assumptions of <code>lm1</code></a></li>
<li class="chapter" data-level="4.2.4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#assumptions-not-met---what-is-wrong"><i class="fa fa-check"></i><b>4.2.4</b> Assumptions not met - what is wrong?</a></li>
<li class="chapter" data-level="4.2.5" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#assumptions-not-met---how-to-proceed"><i class="fa fa-check"></i><b>4.2.5</b> Assumptions not met - how to proceed?</a></li>
<li class="chapter" data-level="4.2.6" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#step-3.-analyze-parameter-estimates"><i class="fa fa-check"></i><b>4.2.6</b> <strong>Step 3.</strong> Analyze parameter estimates</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#model-interpretation"><i class="fa fa-check"></i><b>4.3</b> Model interpretation</a><ul>
<li class="chapter" data-level="4.3.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#finding-a-better-model-terrestrial-birds"><i class="fa fa-check"></i><b>4.3.1</b> Finding a better model: terrestrial birds</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#challenge-2"><i class="fa fa-check"></i><b>4.4</b> Challenge 2</a><ul>
<li class="chapter" data-level="4.4.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#solutions"><i class="fa fa-check"></i><b>4.4.1</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#linear-regression-in-r-2"><i class="fa fa-check"></i><b>4.5</b> Linear regression in R</a></li>
<li class="chapter" data-level="4.6" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#variable-names"><i class="fa fa-check"></i><b>4.6</b> Variable names</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html"><i class="fa fa-check"></i><b>5</b> t-test and ANOVA</a><ul>
<li class="chapter" data-level="5.1" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#analysis-of-variance-anova"><i class="fa fa-check"></i><b>5.1</b> Analysis of Variance (ANOVA)</a><ul>
<li class="chapter" data-level="5.1.1" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#types-of-anova"><i class="fa fa-check"></i><b>5.1.1</b> Types of ANOVA</a></li>
<li class="chapter" data-level="5.1.2" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#t-test"><i class="fa fa-check"></i><b>5.1.2</b> T-test</a></li>
<li class="chapter" data-level="5.1.3" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#running-an-anova"><i class="fa fa-check"></i><b>5.1.3</b> Running an ANOVA</a></li>
<li class="chapter" data-level="5.1.4" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#verifying-assumptions"><i class="fa fa-check"></i><b>5.1.4</b> Verifying assumptions</a></li>
<li class="chapter" data-level="5.1.5" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#model-output"><i class="fa fa-check"></i><b>5.1.5</b> Model output</a></li>
<li class="chapter" data-level="5.1.6" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#complementary-test"><i class="fa fa-check"></i><b>5.1.6</b> Complementary test</a></li>
<li class="chapter" data-level="5.1.7" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#plotting"><i class="fa fa-check"></i><b>5.1.7</b> Plotting</a></li>
<li class="chapter" data-level="5.1.8" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#going-further-contrasts"><i class="fa fa-check"></i><b>5.1.8</b> Going further: Contrasts</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#two-way-anova"><i class="fa fa-check"></i><b>5.2</b> Two-way ANOVA</a><ul>
<li class="chapter" data-level="5.2.1" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#running-a-two-way-anova"><i class="fa fa-check"></i><b>5.2.1</b> 4.1 Running a two-way ANOVA</a></li>
<li class="chapter" data-level="5.2.2" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#interaction-plot"><i class="fa fa-check"></i><b>5.2.2</b> 4.2 Interaction plot</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="t-test-and-anova.html"><a href="t-test-and-anova.html#unbalanced-anova-advanced-section-optional"><i class="fa fa-check"></i><b>5.3</b> Unbalanced ANOVA (advanced section/ optional)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analysis-of-covariance-ancova.html"><a href="analysis-of-covariance-ancova.html"><i class="fa fa-check"></i><b>6</b> Analysis of covariance (ANCOVA)</a><ul>
<li class="chapter" data-level="6.0.1" data-path="analysis-of-covariance-ancova.html"><a href="analysis-of-covariance-ancova.html#assumptions-1"><i class="fa fa-check"></i><b>6.0.1</b> 6.1 Assumptions</a></li>
<li class="chapter" data-level="6.0.2" data-path="analysis-of-covariance-ancova.html"><a href="analysis-of-covariance-ancova.html#types-of-ancova"><i class="fa fa-check"></i><b>6.0.2</b> 6.2 Types of ANCOVA</a></li>
<li class="chapter" data-level="6.0.3" data-path="analysis-of-covariance-ancova.html"><a href="analysis-of-covariance-ancova.html#running-an-ancova"><i class="fa fa-check"></i><b>6.0.3</b> 6.3 Running an ANCOVA</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html"><i class="fa fa-check"></i><b>7</b> Multiple linear regression</a><ul>
<li class="chapter" data-level="7.0.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#model-formulation-1"><i class="fa fa-check"></i><b>7.0.1</b> Model formulation</a></li>
<li class="chapter" data-level="7.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#assumptions-2"><i class="fa fa-check"></i><b>7.1</b> Assumptions</a><ul>
<li class="chapter" data-level="7.1.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#if-variables-are-collinear"><i class="fa fa-check"></i><b>7.1.1</b> If variables are collinear</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#multiple-linear-regression-in-r"><i class="fa fa-check"></i><b>7.2</b> Multiple linear regression in R</a><ul>
<li class="chapter" data-level="7.2.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#the-data"><i class="fa fa-check"></i><b>7.2.1</b> The data</a></li>
<li class="chapter" data-level="7.2.2" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#verify-assumptions"><i class="fa fa-check"></i><b>7.2.2</b> Verify assumptions</a></li>
<li class="chapter" data-level="7.2.3" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#linear-regression"><i class="fa fa-check"></i><b>7.2.3</b> Linear regression</a></li>
<li class="chapter" data-level="7.2.4" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#find-the-best-fit-model"><i class="fa fa-check"></i><b>7.2.4</b> Find the best-fit model</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#polynomial-regression-additional-material"><i class="fa fa-check"></i><b>7.3</b> Polynomial regression (additional material)</a></li>
<li class="chapter" data-level="7.4" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#variation-partitioning-additional-material"><i class="fa fa-check"></i><b>7.4</b> Variation Partitioning (additional material)</a></li>
</ul></li>
<li class="part"><span><b>Final considerations</b></span></li>
<li class="chapter" data-level="8" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>8</b> Summary</a></li>
<li class="chapter" data-level="9" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i><b>9</b> Additional resources</a></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 4: Linear models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>


<!-- 
<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
--!>
<div id="t-test-and-anova" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> t-test and ANOVA</h1>
<p><img src="images/schema_ttest.png" /></p>
<div id="analysis-of-variance-anova" class="section level2">
<h2><span class="header-section-number">5.1</span> Analysis of Variance (ANOVA)</h2>
<p>Analysis of Variance (ANOVA) is a type of linear model for a continuous
response variable and one or more categorical explanatory variables. The
categorical explanatory variables can have any number of levels
(groups). For example, the variable "colour" might have three levels:
green, blue, and yellow. ANOVA tests whether the means of the response
variable differ between the levels by comparing the variation within a
group with the variation amon groups. For example, if blueberries differ
in their mass depending on their colour.</p>
<p>ANOVA calculations are based on the sum of squares partitioning and
compares the within-level variance to the between-level
variance. If the between-level variance is greater than the
within-level variance, this means that the levels affect the
explanatory variable more than the random error (corresponding to the
within-level variance), and that the explanatory variable is likely
to be significantly influenced by the levels.</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-43-1.png" width="624" /></p>
<p>In the ANOVA, the comparison of the between-level variance to the
within-level variance is made through the calculation of the
F-statistic that correspond to the ratio of the mean sum of squares of
the level (MS<sub>Lev</sub>) on the mean sum of squares of the error (MS<sub><span class="math inline">\(\epsilon\)</span></sub>).
These two last terms are obtained by dividing their two respective sums
of squares by their corresponding degrees of freedom, as is typically
presented in a ANOVA table . Finally, the p-value of the ANOVA is calculated
from the F-statistic that follows a Chi-square (χ<sup>2</sup>) distribution.</p>
<table style="width:99%;">
<colgroup>
<col width="5%" />
<col width="8%" />
<col width="27%" />
<col width="24%" />
<col width="17%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Source of<br />
variation</th>
<th align="left">Degrees of<br />
freedom (df)</th>
<th align="left">Sums of squares</th>
<th align="center">Mean squares</th>
<th align="center">F-statistic</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Total</td>
<td align="left"><span class="math inline">\(ra-1\)</span></td>
<td align="left"><span class="math inline">\(SS_{t}=\sum(y_{i}-\overline{y})^{2}\)</span></td>
<td align="center"></td>
<td align="center"></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Facteur A</td>
<td align="left"><span class="math inline">\(a-1\)</span></td>
<td align="left"><span class="math inline">\(SS_{f}=\sum(\hat{y_{i}}-\overline{y})^{2}\)</span></td>
<td align="center"><span class="math inline">\(MS_{f}=\frac{SS_{f}}{(a-1)}\)</span></td>
<td align="center"><span class="math inline">\(F=\frac{MS_{f}} {MS_{E}}\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Error</td>
<td align="left"><span class="math inline">\(a(r-1)\)</span></td>
<td align="left"><span class="math inline">\(SS_{\epsilon}=\sum(y_{i}-\hat{y_{i}})^{2}\)</span></td>
<td align="center"><span class="math inline">\(MS_{\epsilon}=\frac{SS_{\epsilon}}{a(r-1)}\)</span></td>
<td align="center"></td>
<td></td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(a\)</span>: number of levels of the explanatory variable A</p>
<p><span class="math inline">\(r\)</span>: number of replicates per level</p>
<p><span class="math inline">\(\overline{y}\)</span>: general mean of the explanatory variable</p>
<p><span class="math inline">\(\hat{y_{i}}\)</span> : mean of the explanatory variable for all the replicates of the level i.</p>
<div id="types-of-anova" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Types of ANOVA</h3>
<ol style="list-style-type: decimal">
<li><strong>One-way ANOVA</strong><br />
One categorical explanatory variable with 2 or more levels. If there
are 2 levels a <a href="t-test-and-anova.html#t-test">t-test</a>can be used alternatively.</li>
<li><strong>Two-way ANOVA</strong> <a href="t-test-and-anova.html#running-an-anova">(see section
4.1.3)</a><br />

<ul>
<li>2 categorical explanatory variables or more,<br />
</li>
<li>Each categorical explanatory variable can have multiple levels,<br />
</li>
<li>The interactions between each categorical explanatory variable
can be tested.</li>
</ul></li>
<li><strong>Repeated measures</strong><br />
ANOVA can be used for repeated measures, but we won’t cover this
today. <strong>Linear Mixed-effect Models</strong> can also be used for this kind
of data <em><a href="https://r.qcbs.ca/workshops/r-workshop-06/">(see Workshop 6)</a></em>.</li>
</ol>
</div>
<div id="t-test" class="section level3">
<h3><span class="header-section-number">5.1.2</span> T-test</h3>
<p>When you have a single explanatory variable which is qualitative and only have <strong>two levels</strong>, you
can run a <em>student’s T-test</em> to test for a difference in the mean of the
two levels. If appropriate for your data, you can choose to test a
unilateral hypothesis. This means that you can test the more specific
assumption that one level has a higher mean than the other, rather than
that they simply have different means.Note that robustness of this test increases with sample size and is higher when groups have equal sizes</p>
<p>For the t-test, the t statistic used to find the p-value calculation is calculated as:
<span class="math inline">\(t = (\overline{y_{1}}-\overline{y_{2}})/\sqrt{\frac{s_{1}^2} n_{1} + \frac{s_{2}^2} n_{2}}\)</span></p>
<p>where</p>
<p><span class="math inline">\(\overline{y_{1}}\)</span> and <span class="math inline">\(\overline{y_{2}}\)</span> are the means of the response variable y for group 1 and 2, respectively,<br />
<span class="math inline">\(s_{1}^2\)</span> and <span class="math inline">\(s_{2}^2\)</span> are the variances of the response variable y for group 1 and 2, respectively,<br />
<span class="math inline">\(n_{1}\)</span> and <span class="math inline">\(n_{2}\)</span> are the sample sizes of groups 1 and 2, respectively.</p>
<p>Note that the t-test is mathematically equivalent to a one-way ANOVA
with 2 levels.</p>
<div id="assumptions" class="section level4">
<h4><span class="header-section-number">5.1.2.1</span> Assumptions</h4>
<p>If the assumptions of the t-test are not met, the test can give
misleading results. Here are some important things to note when testing
the assumptions of a t-test.</p>
<ol style="list-style-type: decimal">
<li><strong>Normality of data</strong><br />
As with simple linear regression, the residuals need to be normally
distributed. If the data are not normally distributed, but have
reasonably symmetrical distributions, a mean which is close to the
centre of the distribution, and only one mode (highest point in the
frequency histogram) then a t-test will still work as long as the
sample is sufficiently large (rule of thumb ~30 observations). If
the data is heavily skewed, then we may need a very large sample
before a t-test works. In such cases, an alternate non-parametric
test should be used.</li>
<li><strong>Homoscedasticity</strong><br />
Another important assumption of the two-sample t-test is that the
variance of your two samples are equal. This allows you to calculate
a pooled variance, which in turn is used to calculate the standard
error. If population variances are unequal, then the probability of
a Type I error is greater than α.<br />
The robustness of the t-test increases with sample size and is
higher when groups have equal sizes.<br />
We can test for difference in variances among two populations and
ask what is the probability of taking two samples from two
populations having identical variances and have the two sample
variances be as different as are <span class="math inline">\(s_{1}^2\)</span> and <span class="math inline">\(s_{2}^2\)</span>.<br />
To do so, we must do the variance ratio test (i.e. an F-test).</li>
</ol>
</div>
<div id="violation-of-assumptions" class="section level4">
<h4><span class="header-section-number">5.1.2.2</span> Violation of assumptions</h4>
<p>If variances between groups are not equal, it is possible to use
corrections, like the <a href="http://en.wikipedia.org/wiki/Welch&#39;s_t_test">Welch
correction</a>. If assumptions
cannot be respected, you can transform your data (log or square root for example) or use the non-parametric equivalent of t-test, the
<a href="http://en.wikipedia.org/wiki/Mann–Whitney_U_test">Mann-Whitney test</a>.
Finally, if the two groups are not independent (e.g. measurements on the
same individual at 2 different years), you should use a <a href="http://en.wikipedia.org/wiki/Student&#39;s_t-test#Paired_samples">Paired
t-test</a>.</p>
</div>
<div id="running-a-t-test" class="section level4">
<h4><span class="header-section-number">5.1.2.3</span> Running a t-test</h4>
<p>In R, t-tests are implemented using the function <code>t.test</code>.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="t-test-and-anova.html#cb54-1"></a><span class="kw">t.test</span>(Y <span class="op">~</span><span class="st"> </span>X2, <span class="dt">data =</span> data, <span class="dt">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="dt">var.equal =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>where:<br />
-<code>Y</code> is the response variable<br />
-<code>X2</code> is a qualitative variable with two levels<br />
-<code>data</code> is the name given to your data set<br />
-<code>alternative</code> refers to the alternative hypothesis. <code>'two.sided'</code> is the default setting. You can also choose <code>'less'</code> or <code>'greater'</code>. For more details, look this <a href="t-test-and-anova.html#unilateral-t-test">section</a>.<br />
-<code>var.eqal</code>, if true, this increases the robustness of the test. But we need to test for it prior to testing.</p>
<p>Let’s look at an exemple with bird diet data.
For example, let’s test the mass difference between aquatic and non-aquatic birds qith the column <code>Aquatic</code>.
First, we can start with visualizing the data:</p>
<p><img src="book-en_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>There seem to be a difference just by looking at the boxplot. Let’s make sure are assumptions are met before doing the test.<br />
<strong>Note</strong>: we do not need to test the assumption of normally distributed data since we already log transformed the data above</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="t-test-and-anova.html#cb55-1"></a><span class="co"># Assumption of equal variance</span></span>
<span id="cb55-2"><a href="t-test-and-anova.html#cb55-2"></a><span class="kw">var.test</span>(logMass <span class="op">~</span><span class="st"> </span>Aquatic, <span class="dt">data =</span> bird)</span></code></pre></div>
<pre><code>## 
##  F test to compare two variances
## 
## data:  logMass by Aquatic
## F = 1.0725, num df = 38, denom df = 14, p-value = 0.9305
## alternative hypothesis: true ratio of variances is not equal to 1
## 95 percent confidence interval:
##  0.3996428 2.3941032
## sample estimates:
## ratio of variances 
##           1.072452</code></pre>
<p>Here, we show that the ratio of variances is not statistically different
from 1, therefore variances are equal, and we proceeded with our t-test.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="t-test-and-anova.html#cb57-1"></a><span class="co"># We are now ready to run the t-test</span></span>
<span id="cb57-2"><a href="t-test-and-anova.html#cb57-2"></a>ttest1 &lt;-<span class="st"> </span><span class="kw">t.test</span>(<span class="dt">x =</span> bird<span class="op">$</span>logMass[bird<span class="op">$</span>Aquatic <span class="op">==</span><span class="st"> </span><span class="dv">0</span>], <span class="dt">y =</span> bird<span class="op">$</span>logMass[bird<span class="op">$</span>Aquatic <span class="op">==</span></span>
<span id="cb57-3"><a href="t-test-and-anova.html#cb57-3"></a><span class="st">    </span><span class="dv">1</span>], <span class="dt">var.equal =</span> <span class="ot">TRUE</span>)</span>
<span id="cb57-4"><a href="t-test-and-anova.html#cb57-4"></a></span>
<span id="cb57-5"><a href="t-test-and-anova.html#cb57-5"></a><span class="co"># or equivalently</span></span>
<span id="cb57-6"><a href="t-test-and-anova.html#cb57-6"></a>ttest1 &lt;-<span class="st"> </span><span class="kw">t.test</span>(logMass <span class="op">~</span><span class="st"> </span>Aquatic, <span class="dt">var.equal =</span> <span class="ot">TRUE</span>, <span class="dt">data =</span> bird)</span>
<span id="cb57-7"><a href="t-test-and-anova.html#cb57-7"></a>ttest1</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  logMass by Aquatic
## t = -7.7707, df = 52, p-value = 2.936e-10
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -3.838340 -2.262829
## sample estimates:
## mean in group 0 mean in group 1 
##        3.645998        6.696582</code></pre>
<p>Since <em>p</em> &lt; 0.05, the hypothesis of no difference between the two bird
types (Aquatic vs. terrestrial) was rejected.</p>
</div>
<div id="running-a-t-test-with-lm" class="section level4">
<h4><span class="header-section-number">5.1.2.4</span> Running a t-test with lm()</h4>
<p>Do not forget that a t test is simply a linear model or an ANOVA for a factor with two levels.
You can reach the same results with :</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="t-test-and-anova.html#cb59-1"></a>lm.t &lt;-<span class="st"> </span><span class="kw">lm</span>(logMass <span class="op">~</span><span class="st"> </span>Aquatic, <span class="dt">data =</span> bird)</span>
<span id="cb59-2"><a href="t-test-and-anova.html#cb59-2"></a><span class="kw">anova</span>(lm.t)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: logMass
##           Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## Aquatic    1 100.816  100.82  60.385 2.936e-10 ***
## Residuals 52  86.817    1.67                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>When variances are equal (i.e., two-sample t-test), we can show that
t<sup>2</sup> = F:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="t-test-and-anova.html#cb61-1"></a>ttest1<span class="op">$</span>statistic<span class="op">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>##       t 
## 60.3845</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="t-test-and-anova.html#cb63-1"></a><span class="kw">anova</span>(lm.t)<span class="op">$</span>F</span></code></pre></div>
<pre><code>## [1] 60.3845      NA</code></pre>
</div>
<div id="unilateral-t-test" class="section level4">
<h4><span class="header-section-number">5.1.2.5</span> Unilateral t-test</h4>
<p>The <em>alternative</em> option of the <code>t.test</code> function allows for the use of
unilateral t-test. By default, <code>t.test()</code> use <code>'two-sided'</code>, which tests whether the means are different from each other. If you want to test whether one mean is higher than the other one, you can use <code>'less'</code> (<span class="math inline">\(\overline{y_{1}}\)</span> &lt; <span class="math inline">\(\overline{y_{2}}\)</span>) or <code>'greater'</code> (<span class="math inline">\(\overline{y_{1}}\)</span> &gt; <span class="math inline">\(\overline{y_{2}}\)</span>). For example, if users want to test if non-aquatic birds are less heavy than aquatic birds, the function can be written:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="t-test-and-anova.html#cb65-1"></a><span class="co"># Unilateral T-test</span></span>
<span id="cb65-2"><a href="t-test-and-anova.html#cb65-2"></a>uni.ttest1 &lt;-<span class="st"> </span><span class="kw">t.test</span>(logMass <span class="op">~</span><span class="st"> </span>Aquatic, <span class="dt">var.equal =</span> <span class="ot">TRUE</span>, <span class="dt">data =</span> bird,</span>
<span id="cb65-3"><a href="t-test-and-anova.html#cb65-3"></a>    <span class="dt">alternative =</span> <span class="st">&quot;less&quot;</span>)</span></code></pre></div>
<p>In the R output, called by <code>uni.ttest1</code>, the results of the t-test
appear in the third line:</p>
<pre><code>## 
##  Two Sample t-test
## 
## data:  logMass by Aquatic
## t = -7.7707, df = 52, p-value = 1.468e-10
## alternative hypothesis: true difference in means between group 0 and group 1 is less than 0
## 95 percent confidence interval:
##       -Inf -2.393147
## sample estimates:
## mean in group 0 mean in group 1 
##        3.645998        6.696582</code></pre>
<p>In this case, the calculated t-statistic is t = -7.7707 with df = 52
degrees of freedom that gives a p-value of p-value = 1.468e-10. As the
calculated p-value is inferior to 0.05, the null hypothesis is rejected.
Thus, aquatic birds are significantly heavier than non-aquatic birds.</p>
<p>We could have tested whether non-aquatic birds were heavier than aquatic bird. By testing the opposite, we get the same t value (but negative) and a p-value reflected accordingly. We can therefore conclude that non-aquatic birds are not significantly heavier than aquatic birds.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="t-test-and-anova.html#cb67-1"></a><span class="co"># Test de t en spécifiant l&#39;argument &#39;alternative&#39;</span></span>
<span id="cb67-2"><a href="t-test-and-anova.html#cb67-2"></a>uni.ttest1 &lt;-<span class="st"> </span><span class="kw">t.test</span>(logMass <span class="op">~</span><span class="st"> </span>Aquatic, <span class="dt">var.equal =</span> <span class="ot">TRUE</span>, <span class="dt">data =</span> bird,</span>
<span id="cb67-3"><a href="t-test-and-anova.html#cb67-3"></a>    <span class="dt">alternative =</span> <span class="st">&quot;greater&quot;</span>)</span>
<span id="cb67-4"><a href="t-test-and-anova.html#cb67-4"></a>uni.ttest1</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  logMass by Aquatic
## t = -7.7707, df = 52, p-value = 1
## alternative hypothesis: true difference in means between group 0 and group 1 is greater than 0
## 95 percent confidence interval:
##  -3.708022       Inf
## sample estimates:
## mean in group 0 mean in group 1 
##        3.645998        6.696582</code></pre>
</div>
</div>
<div id="running-an-anova" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Running an ANOVA</h3>
<p>The t-test is only for a single categorical explanatory variable with 2
levels. For all other linear models with categorical explanatory
variables we use ANOVA.</p>
<p>When the ANOVA detects a significant difference between groups, it does not tell you which group (or groups) differs from the others.A commonly used <em>post-hoc</em> test to answer this question is the <a href="t-test-and-anova.html#complementary-test">Tukey’s test</a>. You may also compare between groups using planned comparisons or <a href="##going-further-contrasts">contrasts</a>. This is more elegant, because it expects that you have an <em>a priori</em> expectation for the differences between groups.</p>
</div>
<div id="verifying-assumptions" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Verifying assumptions</h3>
<p>As with the simple linear regression and t-test, ANOVA must meet the
four assumptions of linear models. Below are some tips in how to test
these assumptions for an ANOVA.</p>
<ol style="list-style-type: decimal">
<li><strong>Normal distribution</strong><br />
The residuals of ANOVA model can once again be visualised in the
normal QQplot. If the residuals lie linearly on the 1:1 line of the
QQplot, they can be considered as normally distributed. If not, the
ANOVA results cannot be interpreted.</li>
<li><strong>Homoscedasticity</strong><br />
To be valid, ANOVA must be performed on models with homogeneous
variance of the residuals. This homoscedasticity can be verified
using either the residuals vs fitted plot or the scale-location plot
of the diagnostic plots. If these plots present equivalent spread of
the residuals for each of the fitted values, then the residuals
variance can be considered homogeneous.<br />
A second way to assess the homogeneity of residuals variance is to
perform a Bartlett test on the anova model using the function
<code>bartlett.test</code>. If the p-value of this test is superior to 0.05,
the null hypothesis H<sub>0</sub>: s<sub>1</sub><sup>2</sup> = s<sub>2</sub><sup>2</sup> =... = s<sub>j</sub><sup>2</sup> =... =
s<sub>n</sub><sup>2</sup> is accepted and the homoscedasticity assumption is
respected.<br />
Usual transformations of explanatory variables can be used if the
homogeneity of residuals variance is not met.</li>
<li><strong>Additivity</strong><br />
In addition to the assumption testing, it is important to consider
whether the effects of two factors are additive. The effects are
additive if the effect of one factor remains constant over all
levels of the other factor, and that each factor influences the
response variable independently of the other factor(s).</li>
</ol>
<p>If assumptions are violated your can try to transform your data, which
could potentially equalize variances and normalize residuals, and can
convert a multiplicative effect into an additive effect. Or, if you
can’t (or don’t want to) transform your data, the non-parametric
equivalent of ANOVA is <a href="http://en.wikipedia.org/wiki/Kruskal–Wallis_one-way_analysis_of_variance">Kruskal-Wallis
test</a>.</p>
<div id="example-with-bird-data" class="section level4">
<h4><span class="header-section-number">5.1.4.1</span> Example with <code>bird</code> data</h4>
<p>We are interested to test if maximal abundance of birds depend on the diet.</p>
<p>First, let’s visualize the data using <code>boxplot()</code>. Recall that by default, R will order you groups in
alphabetical order. We can reorder the groups according to the median of
each Diet level.<br />
</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="t-test-and-anova.html#cb69-1"></a><span class="co"># Default alphabetical order</span></span>
<span id="cb69-2"><a href="t-test-and-anova.html#cb69-2"></a><span class="kw">boxplot</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="t-test-and-anova.html#cb70-1"></a><span class="co"># Relevel factors</span></span>
<span id="cb70-2"><a href="t-test-and-anova.html#cb70-2"></a>med &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">tapply</span>(bird<span class="op">$</span>logMaxAbund, bird<span class="op">$</span>Diet, median))</span>
<span id="cb70-3"><a href="t-test-and-anova.html#cb70-3"></a><span class="kw">boxplot</span>(logMaxAbund <span class="op">~</span><span class="st"> </span><span class="kw">factor</span>(Diet, <span class="dt">levels =</span> <span class="kw">names</span>(med)), <span class="dt">data =</span> bird,</span>
<span id="cb70-4"><a href="t-test-and-anova.html#cb70-4"></a>    <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;lightblue1&quot;</span>, <span class="st">&quot;skyblue1&quot;</span>, <span class="st">&quot;skyblue3&quot;</span>, <span class="st">&quot;skyblue4&quot;</span>))</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-53-2.png" width="672" />
Another way to graphically view the effect sizes is to use <code>plot.design()</code>. This function will illustrate the levels of a particular factor along a vertical line, and the overall value of the response is drawn as a horizontal line.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="t-test-and-anova.html#cb71-1"></a><span class="kw">plot.design</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird, <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="st">&quot;log&quot;</span>[<span class="dv">10</span>] <span class="op">*</span></span>
<span id="cb71-2"><a href="t-test-and-anova.html#cb71-2"></a><span class="st">    &quot;(Maximum Abundance)&quot;</span>))</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<p>There seem to be some differences. We now need to check the assumption to our model.
<strong>Note</strong>: We need to perform the ANOVA to look at the residuals, however, results are not to be interpreted until we have verified the assumptions.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="t-test-and-anova.html#cb72-1"></a><span class="co"># Plot for diagnostics</span></span>
<span id="cb72-2"><a href="t-test-and-anova.html#cb72-2"></a>aov1 &lt;-<span class="st"> </span><span class="kw">aov</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span>
<span id="cb72-3"><a href="t-test-and-anova.html#cb72-3"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb72-4"><a href="t-test-and-anova.html#cb72-4"></a><span class="kw">plot</span>(aov1)</span>
<span id="cb72-5"><a href="t-test-and-anova.html#cb72-5"></a><span class="kw">par</span>(opar)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-56-1.png" width="672" />
Ideally the first diagnostic plot should show similar scatter for each Diet level. We can use only these graph to verify our assumptions, however, we can also use the Shapiro’s, Bartlett’s tests or Levene’s test. <strong>Note</strong>:Levene’s test performs better, but has a slightly higher Type II error.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="t-test-and-anova.html#cb73-1"></a><span class="co"># Test assumption of normality of residuals</span></span>
<span id="cb73-2"><a href="t-test-and-anova.html#cb73-2"></a><span class="kw">shapiro.test</span>(<span class="kw">resid</span>(aov1))</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(aov1)
## W = 0.97995, p-value = 0.4982</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="t-test-and-anova.html#cb75-1"></a><span class="co"># Test assumption of homogeneity of variance Bartlett&#39;s</span></span>
<span id="cb75-2"><a href="t-test-and-anova.html#cb75-2"></a><span class="co"># test</span></span>
<span id="cb75-3"><a href="t-test-and-anova.html#cb75-3"></a><span class="kw">bartlett.test</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span></code></pre></div>
<pre><code>## 
##  Bartlett test of homogeneity of variances
## 
## data:  logMaxAbund by Diet
## Bartlett&#39;s K-squared = 7.4728, df = 4, p-value = 0.1129</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="t-test-and-anova.html#cb77-1"></a><span class="co"># Levene&#39;s test</span></span>
<span id="cb77-2"><a href="t-test-and-anova.html#cb77-2"></a><span class="kw">library</span>(car)</span>
<span id="cb77-3"><a href="t-test-and-anova.html#cb77-3"></a><span class="kw">leveneTest</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value  Pr(&gt;F)  
## group  4  2.3493 0.06717 .
##       49                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The tests are non-significant, therefore residuals are assumed to be normally distributed and variances
are assumed to be equal.</p>
<p>Let’s now run the ANOVA. In R, ANOVA can be called either directly with the <code>aov</code> function, or with the <code>anova</code> function performed on a linear model previously implemented with <code>lm</code>:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="t-test-and-anova.html#cb79-1"></a><span class="co"># Using aov()</span></span>
<span id="cb79-2"><a href="t-test-and-anova.html#cb79-2"></a>aov1 &lt;-<span class="st"> </span><span class="kw">aov</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span>
<span id="cb79-3"><a href="t-test-and-anova.html#cb79-3"></a><span class="kw">summary</span>(aov1)</span>
<span id="cb79-4"><a href="t-test-and-anova.html#cb79-4"></a></span>
<span id="cb79-5"><a href="t-test-and-anova.html#cb79-5"></a><span class="co"># Using lm()</span></span>
<span id="cb79-6"><a href="t-test-and-anova.html#cb79-6"></a>anov1 &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span>
<span id="cb79-7"><a href="t-test-and-anova.html#cb79-7"></a><span class="kw">anova</span>(anov1)</span></code></pre></div>
</div>
</div>
<div id="model-output" class="section level3">
<h3><span class="header-section-number">5.1.5</span> Model output</h3>
<p>Once your ANOVA model has been validated, its results can be
interpreted. The R output of ANOVA model depends of the function that
has been used to implement the ANOVA. If the <code>aov</code> function is used to
implement the ANOVA model</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="t-test-and-anova.html#cb80-1"></a>aov1 &lt;-<span class="st"> </span><span class="kw">aov</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span></code></pre></div>
<p>the results of the ANOVA can be visualized using the function</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="t-test-and-anova.html#cb81-1"></a><span class="kw">summary</span>(aov1)</span></code></pre></div>
<p>On the other hand, if <code>lm()</code> is used</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="t-test-and-anova.html#cb82-1"></a>anov1 &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span></code></pre></div>
<p>the ANOVA results must be called using the function</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="t-test-and-anova.html#cb83-1"></a><span class="kw">anova</span>(anov1)</span></code></pre></div>
<p>In both cases, the R output is as follows:</p>
<pre><code>##             Df Sum Sq Mean Sq F value Pr(&gt;F)  
## Diet         4  27.07   6.768   2.836 0.0341 *
## Residuals   49 116.92   2.386                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This R output corresponds exactly to the ANOVA table of your model. This
output also present the degrees of freedom, the sum of squares, the mean
sum of squares and the F-value previously explained. For this example,
the diet significantly influences the abundance of birds as the p-value
is inferior to 0.05. The null hypothesis can then be rejected meaning
that at least one of the diet treatments influenced the abundance
differently than the other treatments.</p>
</div>
<div id="complementary-test" class="section level3">
<h3><span class="header-section-number">5.1.6</span> Complementary test</h3>
<p>Importantly, ANOVA cannot identify which treatment is different from the
others in terms of response variable. It can only identify that a
difference is present. To determine the location of the difference(s),
post-hoc tests that compare the levels of the explanatory variables
(i.e. the treatments) two by two, must be performed. While several
post-hoc tests exist (e.g. Fischer’s least significant difference,
Duncan’s new multiple range test, Newman-Keuls method, Dunnett’s test,
etc.), the Tukey’s range test is used in this example using the function
<code>TukeyHSD</code> as follows:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="t-test-and-anova.html#cb85-1"></a><span class="co"># Where does the Diet difference lie?</span></span>
<span id="cb85-2"><a href="t-test-and-anova.html#cb85-2"></a><span class="kw">TukeyHSD</span>(<span class="kw">aov</span>(anov1), <span class="dt">ordered =</span> T)</span>
<span id="cb85-3"><a href="t-test-and-anova.html#cb85-3"></a></span>
<span id="cb85-4"><a href="t-test-and-anova.html#cb85-4"></a><span class="co"># or equivalently</span></span>
<span id="cb85-5"><a href="t-test-and-anova.html#cb85-5"></a><span class="kw">TukeyHSD</span>(aov1, <span class="dt">ordered =</span> T)</span></code></pre></div>
<p>The R output for this test gives a table containing all the two by two
comparisons of the explanatory variable levels and identify which
treatment differ from the others:<br />
</p>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
##     factor levels have been ordered
## 
## Fit: aov(formula = logMaxAbund ~ Diet, data = bird)
## 
## $Diet
##                             diff         lwr      upr     p adj
## Vertebrate-InsectVert  0.7746576 -2.56640638 4.115722 0.9645742
## Insect-InsectVert      1.4815601 -1.76264078 4.725761 0.6965047
## Plant-InsectVert       2.0364840 -2.33799553 6.410964 0.6812494
## PlantInsect-InsectVert 2.4539424 -0.80660217 5.714487 0.2235587
## Insect-Vertebrate      0.7069025 -0.89043156 2.304237 0.7204249
## Plant-Vertebrate       1.2618265 -2.07923748 4.602890 0.8211024
## PlantInsect-Vertebrate 1.6792848  0.04901254 3.309557 0.0405485
## Plant-Insect           0.5549239 -2.68927692 3.799125 0.9884504
## PlantInsect-Insect     0.9723823 -0.44885612 2.393621 0.3117612
## PlantInsect-Plant      0.4174584 -2.84308619 3.678003 0.9961844</code></pre>
<p>In this case, the only significant difference in abundance occurs
between the PlantInsect diet and the Vertebrate diet.</p>
</div>
<div id="plotting" class="section level3">
<h3><span class="header-section-number">5.1.7</span> Plotting</h3>
<p>After having verified the assumptions of your ANOVA model, interpreted
the ANOVA table and differentiated the effect of the treatments using
post-hoc tests or contrasts, the ANOVA results can be graphically
illustrated using a <code>barplot</code>. This shows the response variable as a
function of the explanatory variable levels, where standard errors can
be superimposed on each bar as well as the different letters
representing the treatment group (according to the post-hoc test).</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="t-test-and-anova.html#cb87-1"></a><span class="co"># Graphical illustration of ANOVA model using barplot()</span></span>
<span id="cb87-2"><a href="t-test-and-anova.html#cb87-2"></a></span>
<span id="cb87-3"><a href="t-test-and-anova.html#cb87-3"></a>sd &lt;-<span class="st"> </span><span class="kw">tapply</span>(bird<span class="op">$</span>logMaxAbund, <span class="kw">list</span>(bird<span class="op">$</span>Diet), sd)</span>
<span id="cb87-4"><a href="t-test-and-anova.html#cb87-4"></a>means &lt;-<span class="st"> </span><span class="kw">tapply</span>(bird<span class="op">$</span>logMaxAbund, <span class="kw">list</span>(bird<span class="op">$</span>Diet), mean)</span>
<span id="cb87-5"><a href="t-test-and-anova.html#cb87-5"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(bird<span class="op">$</span>logMaxAbund)</span>
<span id="cb87-6"><a href="t-test-and-anova.html#cb87-6"></a>se &lt;-<span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>sd<span class="op">/</span><span class="kw">sqrt</span>(n)</span>
<span id="cb87-7"><a href="t-test-and-anova.html#cb87-7"></a></span>
<span id="cb87-8"><a href="t-test-and-anova.html#cb87-8"></a>bp &lt;-<span class="st"> </span><span class="kw">barplot</span>(means, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;lightblue1&quot;</span>, <span class="st">&quot;skyblue1&quot;</span>,</span>
<span id="cb87-9"><a href="t-test-and-anova.html#cb87-9"></a>    <span class="st">&quot;skyblue3&quot;</span>, <span class="st">&quot;skyblue4&quot;</span>), <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="st">&quot;log&quot;</span>[<span class="dv">10</span>] <span class="op">*</span><span class="st"> &quot;(Maximum Abundance)&quot;</span>),</span>
<span id="cb87-10"><a href="t-test-and-anova.html#cb87-10"></a>    <span class="dt">xlab =</span> <span class="st">&quot;Diet&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb87-11"><a href="t-test-and-anova.html#cb87-11"></a></span>
<span id="cb87-12"><a href="t-test-and-anova.html#cb87-12"></a><span class="co"># Add vertical se bars</span></span>
<span id="cb87-13"><a href="t-test-and-anova.html#cb87-13"></a><span class="kw">segments</span>(bp, means <span class="op">-</span><span class="st"> </span>se, bp, means <span class="op">+</span><span class="st"> </span>se, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb87-14"><a href="t-test-and-anova.html#cb87-14"></a><span class="co"># and horizontal lines</span></span>
<span id="cb87-15"><a href="t-test-and-anova.html#cb87-15"></a><span class="kw">segments</span>(bp <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span>, means <span class="op">-</span><span class="st"> </span>se, bp <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>, means <span class="op">-</span><span class="st"> </span>se, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb87-16"><a href="t-test-and-anova.html#cb87-16"></a><span class="kw">segments</span>(bp <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span>, means <span class="op">+</span><span class="st"> </span>se, bp <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>, means <span class="op">+</span><span class="st"> </span>se, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb87-17"><a href="t-test-and-anova.html#cb87-17"></a><span class="co"># add a line at 0</span></span>
<span id="cb87-18"><a href="t-test-and-anova.html#cb87-18"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
</div>
<div id="going-further-contrasts" class="section level3">
<h3><span class="header-section-number">5.1.8</span> Going further: Contrasts</h3>
<p>Contrasts compare each level of a factor to a baseline level and therefore, we can determine if each level of a factor are significantly different from each other.</p>
<p>Contrasts are based on an <em>a priori</em> hypothesis, which makes them much more robust than <em>a posteriori</em> comparison like Tukey’s test. With contrasts, groups can be compounded of one or many levels of a factor, and we can test basic hypothesis (ex: μ<sub>1</sub> = μ<sub>2</sub>) or more complex hypothesis (ex: (μ<sub>1</sub> + μ<sub>2</sub>)/3 == μ<sub>3</sub>).</p>
<p><em>Important requirement</em>
The number of comparisons has to be lower or equal to the number of
degrees of freedom of the ANOVA. Comparisons have to be independent from
one another.</p>
<p>For ANOVAs where explanatory variables are categorical, the intercept is the baseline group and corresponds to the mean of the first (alphabetically) level. By calculating the intercept and coefficient estimates of each <code>Diet</code> level, <em>What do you notice</em>?</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="t-test-and-anova.html#cb88-1"></a><span class="kw">tapply</span>(bird<span class="op">$</span>logMaxAbund, bird<span class="op">$</span>Diet, mean)</span></code></pre></div>
<pre><code>##      Insect  InsectVert       Plant PlantInsect  Vertebrate 
##    2.656938    1.175378    3.211862    3.629321    1.950036</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="t-test-and-anova.html#cb90-1"></a><span class="kw">coef</span>(anov1)</span></code></pre></div>
<pre><code>##     (Intercept)  DietInsectVert       DietPlant DietPlantInsect  DietVertebrate 
##       2.6569384      -1.4815601       0.5549239       0.9723823      -0.7069025</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="t-test-and-anova.html#cb92-1"></a><span class="kw">coef</span>(anov1)[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="kw">coef</span>(anov1)[<span class="dv">2</span>]  <span class="co"># InsectVert</span></span></code></pre></div>
<pre><code>## (Intercept) 
##    1.175378</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="t-test-and-anova.html#cb94-1"></a><span class="kw">coef</span>(anov1)[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="kw">coef</span>(anov1)[<span class="dv">3</span>]  <span class="co"># Plant</span></span></code></pre></div>
<pre><code>## (Intercept) 
##    3.211862</code></pre>
<p>Mean for <code>Insect</code> corresponds to the intercept of our ANOVA <code>anov1</code>.</p>
<p>You can also reach those results by using the function <code>summary.lm()</code> or `summary(). This output performs a linear regression for each level of the explanatory variable and calculates their associated
parameters.</p>
<p><strong>Note</strong>: When the ANOVA model was implemented with the <code>aov</code>
function, this output is called using the function
<code>summary.lm()</code>. Use the function <code>summary()</code> when the ANOVA was implemented
with the <code>lm</code> function.</p>
<pre><code>## 
## Call:
## lm(formula = logMaxAbund ~ Diet, data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2664 -0.7592 -0.2028  1.0908  3.5938 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       2.6569     0.3454   7.692 5.66e-10 ***
## DietInsectVert   -1.4816     1.1456  -1.293   0.2020    
## DietPlant         0.5549     1.1456   0.484   0.6303    
## DietPlantInsect   0.9724     0.5019   1.938   0.0585 .  
## DietVertebrate   -0.7069     0.5640  -1.253   0.2161    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.545 on 49 degrees of freedom
## Multiple R-squared:  0.188,  Adjusted R-squared:  0.1217 
## F-statistic: 2.836 on 4 and 49 DF,  p-value: 0.0341</code></pre>
<p>Users can note that the last line of this R output corresponds exactly to the previous R output shown in the ANOVA table. The F-statistic of
the ANOVA model and its associated p-value (i.e. 2.836 and 0.0341), are
the same one as the values obtained from the ANOVA table, indicating
diet explains the abundance better than a null model, and so, diet
significantly influence the abundance. The goodness-of-fit of the ANOVA
model (i.e. adjusted R-square value) appears in the second to last line
of this output. In this case, diet explains 12.17% of the abundance
variability.<br />
</p>
<p>Contrasts adjust a linear regression of the response variable as
function of each level of the categorical explanatory variable
separately. In this case, 5 linear regressions (corresponding to the
five lines of the coefficients table of the R output) are calculated by
the <code>lm</code> function as the diet variable contains 5 levels. By default, the
baseline level corresponding to the intercept is the first level of
explanatory variables ranked in alphabetical order. So in this case, the
<code>Insect</code> diet is automatically used as a baseline in R. In the R output,
the coefficient estimate of the baseline level (here, 1.1539) is first
compared to 0 using a t-test (in this case, the t-test is significant
with a p-value of 5.66e-10), while the coefficient estimates of the
other explanatory variable level are compared to the baseline level. In
this case, only the <code>PlantInsect</code> diet differs from the <code>Insect</code> diet, with
an associated p-value of 0.0585.<br />
In other words, this R output allows us to determine the mean of the
response variable for each of the diet levels, for example:</p>
<p>LogMaxAbund = 1.1539 for the Insect diet,<br />
LogMaxAbund = 1.1539 – 0.6434 for the InsectVert diet,<br />
LogMaxAbund = 1.1539 + 0.2410 for the Plant diet,<br />
etc.</p>
<p>As this type of contrasts compares each level of the explanatory
variable to a baseline level, they are called contr.treatment and
constitute the default method of the <code>lm</code> function in R. The baseline
level can, however, be changed using the <code>relevel</code> function. For
example, the following lines compare each diet treatment to the Plant diet, now defined as the
baseline level.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="t-test-and-anova.html#cb97-1"></a>bird<span class="op">$</span>Diet2 &lt;-<span class="st"> </span><span class="kw">relevel</span>(bird<span class="op">$</span>Diet, <span class="dt">ref =</span> <span class="st">&quot;Plant&quot;</span>)</span>
<span id="cb97-2"><a href="t-test-and-anova.html#cb97-2"></a>anov_rl &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet2, <span class="dt">data =</span> bird)</span>
<span id="cb97-3"><a href="t-test-and-anova.html#cb97-3"></a><span class="kw">summary</span>(anov_rl)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logMaxAbund ~ Diet2, data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2664 -0.7592 -0.2028  1.0908  3.5938 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)        3.2119     1.0923   2.941  0.00499 **
## Diet2Insect       -0.5549     1.1456  -0.484  0.63026   
## Diet2InsectVert   -2.0365     1.5447  -1.318  0.19351   
## Diet2PlantInsect   0.4175     1.1513   0.363  0.71848   
## Diet2Vertebrate   -1.2618     1.1798  -1.070  0.29006   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.545 on 49 degrees of freedom
## Multiple R-squared:  0.188,  Adjusted R-squared:  0.1217 
## F-statistic: 2.836 on 4 and 49 DF,  p-value: 0.0341</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="t-test-and-anova.html#cb99-1"></a><span class="kw">anova</span>(anov_rl)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: logMaxAbund
##           Df  Sum Sq Mean Sq F value Pr(&gt;F)  
## Diet2      4  27.071  6.7677  2.8363 0.0341 *
## Residuals 49 116.918  2.3861                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>You can also reorder multiple levels according to median, instead of the alphabetical order:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="t-test-and-anova.html#cb101-1"></a>med &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">tapply</span>(bird<span class="op">$</span>logMaxAbund, bird<span class="op">$</span>Diet, median))</span>
<span id="cb101-2"><a href="t-test-and-anova.html#cb101-2"></a>bird<span class="op">$</span>Diet2 &lt;-<span class="st"> </span><span class="kw">factor</span>(bird<span class="op">$</span>Diet, <span class="dt">levels =</span> <span class="kw">names</span>(med))</span>
<span id="cb101-3"><a href="t-test-and-anova.html#cb101-3"></a>anov2 &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet2, <span class="dt">data =</span> bird)</span>
<span id="cb101-4"><a href="t-test-and-anova.html#cb101-4"></a><span class="kw">summary</span>(anov2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logMaxAbund ~ Diet2, data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2664 -0.7592 -0.2028  1.0908  3.5938 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)        1.1754     1.0923   1.076   0.2872  
## Diet2Vertebrate    0.7747     1.1798   0.657   0.5145  
## Diet2Insect        1.4816     1.1456   1.293   0.2020  
## Diet2Plant         2.0365     1.5447   1.318   0.1935  
## Diet2PlantInsect   2.4539     1.1513   2.131   0.0381 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.545 on 49 degrees of freedom
## Multiple R-squared:  0.188,  Adjusted R-squared:  0.1217 
## F-statistic: 2.836 on 4 and 49 DF,  p-value: 0.0341</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="t-test-and-anova.html#cb103-1"></a><span class="kw">anova</span>(anov2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: logMaxAbund
##           Df  Sum Sq Mean Sq F value Pr(&gt;F)  
## Diet2      4  27.071  6.7677  2.8363 0.0341 *
## Residuals 49 116.918  2.3861                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The contrasts coefficient matrix of these <code>contr.treatment</code> comparisons can be called by</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="t-test-and-anova.html#cb105-1"></a>bird<span class="op">$</span>Diet2 &lt;-<span class="st"> </span><span class="kw">relevel</span>(bird<span class="op">$</span>Diet, <span class="dt">ref =</span> <span class="st">&quot;Plant&quot;</span>)</span>
<span id="cb105-2"><a href="t-test-and-anova.html#cb105-2"></a><span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)</span></code></pre></div>
<pre><code>##             Insect InsectVert PlantInsect Vertebrate
## Plant            0          0           0          0
## Insect           1          0           0          0
## InsectVert       0          1           0          0
## PlantInsect      0          0           1          0
## Vertebrate       0          0           0          1</code></pre>
<p>where each column corresponds to a comparison to the baseline <code>Plant</code> and
each line to a diet level. For example, the first comparison compares
the <code>Insect</code> diet to the <code>Plant</code> diet, the second one compares the
<code>InsectVert</code> diet to the <code>Plant</code> diet, etc.</p>
<p>The default contrasts <code>contr.treatment</code> is <strong>not</strong> orthogonal, meaning that the sum of the products of their coefficients is <strong>not</strong> null. We can verify if our previous contrasts are orthogonal by checking two things:
- Coefficients must sum to 0
- Any two contrast columns must sum to 0</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="t-test-and-anova.html#cb107-1"></a><span class="kw">sum</span>(<span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">1</span>])  <span class="co"># first condition for column 1</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="t-test-and-anova.html#cb109-1"></a><span class="kw">sum</span>(<span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">2</span>])  <span class="co"># second condition for column 1 and 2</span></span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>The first column equal to 1, which mean our contrasts are not orthogonal.<br />
</p>
<p>Orthogonality is important to make sure our contrasts are <strong>independant</strong>. You can use Helmert or polynomial contrasts to remedy the situation. Helmert contrast will contrast the second level with the first, the third with the average of the first two, and so on.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="t-test-and-anova.html#cb111-1"></a><span class="kw">options</span>(<span class="dt">contrasts =</span> <span class="kw">c</span>(<span class="st">&quot;contr.helmert&quot;</span>, <span class="st">&quot;contr.poly&quot;</span>))</span>
<span id="cb111-2"><a href="t-test-and-anova.html#cb111-2"></a><span class="kw">sum</span>(<span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="t-test-and-anova.html#cb113-1"></a><span class="kw">sum</span>(<span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Our conditions are now equal to 0 and our contrasts are orthogonal.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="t-test-and-anova.html#cb115-1"></a>anov3 &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span>
<span id="cb115-2"><a href="t-test-and-anova.html#cb115-2"></a><span class="kw">summary</span>(anov3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logMaxAbund ~ Diet, data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2664 -0.7592 -0.2028  1.0908  3.5938 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   2.5247     0.3369   7.495 1.14e-09 ***
## Diet1        -0.7408     0.5728  -1.293   0.2020    
## Diet2         0.4319     0.4111   1.051   0.2986    
## Diet3         0.3203     0.1603   1.999   0.0512 .  
## Diet4        -0.1437     0.1206  -1.191   0.2393    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.545 on 49 degrees of freedom
## Multiple R-squared:  0.188,  Adjusted R-squared:  0.1217 
## F-statistic: 2.836 on 4 and 49 DF,  p-value: 0.0341</code></pre>
<p>Users can also create their own contrasts coefficient matrix in order to
perform the comparison they desire using the contrasts function.For
example, the following lines create this contrasts coefficient matrix:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="t-test-and-anova.html#cb117-1"></a><span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2) &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, <span class="dv">-1</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb117-2"><a href="t-test-and-anova.html#cb117-2"></a>    <span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">-1</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb117-3"><a href="t-test-and-anova.html#cb117-3"></a><span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)</span></code></pre></div>
<pre><code>##             [,1] [,2] [,3] [,4]
## Plant          4    0    0    0
## Insect        -1    1    0    1
## InsectVert    -1    1    0   -1
## PlantInsect   -1   -1    1    0
## Vertebrate    -1   -1   -1    0</code></pre>
<p>that compares:<br />
</p>
<ul>
<li>the <code>Plant</code> diet to all the other diets in the first comparison,<br />
</li>
<li>the <code>InsectVert</code> and the <code>Insect</code> diets to the <code>PlantInsect</code> and the <code>Vertebrate</code> diets in the second one,<br />
</li>
<li>the <code>PlantInsect</code> diet to the <code>Vertebrate</code> diet in the third one,<br />
</li>
<li>and the <code>Insect</code> diet to the <code>InsectVert</code> diet in the fourth one.</li>
</ul>
<p>Thus, for each column, the treatments with identical contrasts
coefficient belong to the same two by two comparison group (e.g. in the
column 1, the four treatment with a -1 coefficient belong to the first
comparison group and are altogether compare to the second group
corresponding to the treatment with a different coefficient, here the
<code>Plant</code> diet with a coefficient 4).<br />
</p>
<p>Let’s verify the orthogonality of our contrasts:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="t-test-and-anova.html#cb119-1"></a><span class="kw">sum</span>(<span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">1</span>])  <span class="co"># first condition for column 1</span></span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="t-test-and-anova.html#cb121-1"></a><span class="kw">sum</span>(<span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="kw">contrasts</span>(bird<span class="op">$</span>Diet2)[, <span class="dv">2</span>])  <span class="co"># second condition for column 1 and 2</span></span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>These constrats are orthogonal and could be used to compare factor levels with each other.</p>
<p>Other conventional contrast coefficient matrices are already programmed in R:
<code>help(contrasts)</code></p>
</div>
</div>
<div id="two-way-anova" class="section level2">
<h2><span class="header-section-number">5.2</span> Two-way ANOVA</h2>
<p>In the above section, the ANOVA models had a single categorical
variable. We can create ANOVA models with multiple categorical
explanatory variables. When there are two categorical explanatory
variables, we refer to the model as a two-way ANOVA. A two-way ANOVA
tests several hypotheses: that there is no difference in mean among
levels of variable A; that there is no difference in mean among levels
of variable B; and that there is no interaction between variables A and
B. A significant interaction means the mean value of the response
variable for each level of variable A changes depending on the level of
B. For example, perhaps relationship between the colour of a fruit and
its mass will depend on the plant species: if so, we say there is an
interaction between colour and species.</p>
<p>The one-way ANOVA table has to be rewritten to add the second explanatory term as well as
the interaction term. Thus, a two-way ANOVA table corresponds to:</p>
<table style="width:99%;">
<colgroup>
<col width="6%" />
<col width="9%" />
<col width="35%" />
<col width="31%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Source of<br />
variation</th>
<th align="left">Degrees of<br />
freedom (df)</th>
<th align="left">Sums of squares</th>
<th align="left">Mean squares</th>
<th align="center">F-statistic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Total</td>
<td align="left"><span class="math inline">\(abr-1\)</span></td>
<td align="left"><span class="math inline">\(SS_{t}=\sum_{i,j,k}{}(y_{ijk}-\overline{y})^2\)</span></td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="left">Cells</td>
<td align="left"><span class="math inline">\(ab-1\)</span></td>
<td align="left"><span class="math inline">\(SS_{Cells}=\sum_{i,j}(\overline{y}_{ij}-\overline{y})^2\)</span></td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="left">Within-<br />
cells (error)</td>
<td align="left"><span class="math inline">\(ab(r-1)\)</span></td>
<td align="left"><span class="math inline">\(SS_{\epsilon}=\sum_{i,j,k}(y_{ijk}-\overline{y}_{ij})^2\)</span></td>
<td align="left"><span class="math inline">\(MS_{\epsilon}=\frac{SS_{\epsilon}}{ab(r-1)}\)</span></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="left">Factor A</td>
<td align="left"><span class="math inline">\(a-1\)</span></td>
<td align="left"><span class="math inline">\(SS_{A}= rb\sum_{i}(\overline{y}_{i.}-\overline{y})^2\)</span></td>
<td align="left"><span class="math inline">\(MS_{A}=\frac{SS_{A}}{a-1}\)</span></td>
<td align="center"><span class="math inline">\(F_{A}=\frac{MS_{A}}{MS_{\epsilon}}\)</span></td>
</tr>
<tr class="odd">
<td align="left">Factor B</td>
<td align="left"><span class="math inline">\(b-1\)</span></td>
<td align="left"><span class="math inline">\(SS_{B}= ra\sum_{j}(\overline{y}_{.j}-\overline{y})^2\)</span></td>
<td align="left"><span class="math inline">\(MS_{B}=\frac{SS_{B}}{b-1}\)</span></td>
<td align="center"><span class="math inline">\({F_B}=\frac{MS_{B}}{MS_\epsilon}\)</span></td>
</tr>
<tr class="even">
<td align="left">Interaction<br />
AB</td>
<td align="left"><span class="math inline">\((a-1)(b-1)\)</span></td>
<td align="left"><span class="math inline">\(SS_{AB}= r\sum_{i,j,k}(\overline{y}_{..k}-\overline{y}_{.jk}-\overline{y}_{i.k})^2\)</span></td>
<td align="left"><span class="math inline">\(MS_{AB}=\frac{SS_{AB}}{(a-1)(b-1)}\)</span></td>
<td align="center"><span class="math inline">\(F_{AB}=\frac{MS_{AB}}{MS_\epsilon}\)</span></td>
</tr>
</tbody>
</table>
<p><code>a</code>: number of levels of the explanatory variable A<br />
<code>b</code>: number of levels of the explanatory variable B<br />
<code>r</code>: number of replicates per treatment<br />
<span class="math inline">\(\epsilon\)</span> : error<br />
</p>
<div id="running-a-two-way-anova" class="section level3">
<h3><span class="header-section-number">5.2.1</span> 4.1 Running a two-way ANOVA</h3>
<p>In R, a two-way ANOVA model is implemented in the same fashion as a
one-way ANOVA using the function <code>lm</code>.</p>
<ul>
<li>One-way ANOVA</li>
</ul>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="t-test-and-anova.html#cb123-1"></a>aov &lt;-<span class="st"> </span><span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span>X, data)</span></code></pre></div>
<ul>
<li>Two-way ANOVA</li>
</ul>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="t-test-and-anova.html#cb124-1"></a>aov &lt;-<span class="st"> </span><span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span>X1 <span class="op">*</span><span class="st"> </span>X2 <span class="op">*</span><span class="st"> </span>..., data)</span></code></pre></div>
<p>The * symbol indicates that the main effects, as well, as their <strong>interaction</strong> will be included in the model.</p>
<p>Always start reading the output from the interaction term, then proceed to the main effects. According to law of parsimony, select the model that explain the most variance with the least model parameters as possible: If the multiplicative effect (interaction) is non-signficant, you may consider a model with only the additive effects.</p>
<p>You can then remove the interaction and run the model again.</p>
<p>If use the + symbol, the main effects, but their interaction are <strong>not</strong> included.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="t-test-and-anova.html#cb125-1"></a>aov &lt;-<span class="st"> </span><span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span>X1 <span class="op">+</span><span class="st"> </span>X2 <span class="op">+</span><span class="st"> </span>..., data)</span></code></pre></div>
<hr />
<p><strong>CHALLENGE 2</strong></p>
<p>Examine the effects of the factors Diet, Aquatic, and their interaction
on the maximum bird abundance.</p>
<p>Recall: Before interpreting the ANOVA results, the model must first be
validated by verifying the statistical assumptions of ANOVA, namely
the:<br />
- Normal distribution of the model residuals</p>
<ol style="list-style-type: decimal">
<li>Homoscedasticty of the residuals variance</li>
</ol>
<p>This verification can be done using the four diagnostic plots as
previously explained for one-way ANOVA.<br />
</p>
<details>
<p><summary><strong>Click to see the solution to Challenge 2!</strong></summary></p>
<p>Assumptions</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="t-test-and-anova.html#cb126-1"></a>anov4 &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet <span class="op">*</span><span class="st"> </span>Aquatic, <span class="dt">data =</span> bird)</span>
<span id="cb126-2"><a href="t-test-and-anova.html#cb126-2"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb126-3"><a href="t-test-and-anova.html#cb126-3"></a><span class="kw">plot</span>(anov4)</span></code></pre></div>
<pre><code>## Warning: not plotting observations with leverage one:
##   5, 6, 26</code></pre>
<p><img src="book-en_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="t-test-and-anova.html#cb128-1"></a><span class="kw">par</span>(opar)</span></code></pre></div>
<p>Assumptions are met so we use the <code>anova</code> command to visualize the ANOVA table of the
model:<br />
</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="t-test-and-anova.html#cb129-1"></a><span class="kw">anova</span>(anov4)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: logMaxAbund
##              Df  Sum Sq Mean Sq F value  Pr(&gt;F)  
## Diet          4  27.071  6.7677  3.0378 0.02669 *
## Aquatic       1   1.688  1.6878  0.7576 0.38870  
## Diet:Aquatic  3  14.978  4.9926  2.2410 0.09644 .
## Residuals    45 100.252  2.2278                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>In this case, the only significant term of the model is the diet factor
as the p-value associated with the interaction term is not significant,
meaning that the synergic effect of aquatic/non-aquatic type of birds
does not influence the abundance. The significance of the interaction
can also be determined by comparing two nested ANOVA models, i.e. a
first model with the interaction and a second model without the
interaction, using the <code>anova</code> command:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="t-test-and-anova.html#cb131-1"></a>anov5 &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet <span class="op">+</span><span class="st"> </span>Aquatic, <span class="dt">data =</span> bird)</span>
<span id="cb131-2"><a href="t-test-and-anova.html#cb131-2"></a><span class="kw">anova</span>(anov5, anov4)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: logMaxAbund ~ Diet + Aquatic
## Model 2: logMaxAbund ~ Diet * Aquatic
##   Res.Df    RSS Df Sum of Sq     F  Pr(&gt;F)  
## 1     48 115.23                             
## 2     45 100.25  3    14.978 2.241 0.09644 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>As the only difference between the two compared ANOVA models is the
presence of the interaction term, this R output presents the
significance of this term. In this case, the interaction term is not
significant and can be dropped from the final ANOVA model.<br />
When the interaction term is significant, users should remember that the
single effect of each explanatory variable cannot be interpreted and
only the interaction term can.</p>
<p><span class="ul"><strong>Note:</strong></span>The ANOVA table reports that the number of DF (degrees
of freedom) for the interaction between Diet:Aquatic is 3. According to
the notation in the two-way ANOVA table (for balanced designed), a = 5
and b = 2 and the DF for the interaction should be (a-1)(b-1) = 4*1 =
4. The R output provides a DF of 3 because the Diet*Aquatic treatment
is extremely unbalanced. Namely, since there is no aquatic birds that
feed on plants we loose that interaction (note the NA in the
summary(anov4) output). Please refer to the advanced section on
<a href="t-test-and-anova.html#unbalanced-anova-advanced-section-optional">Unbalanced ANOVA</a>
below for further details.</p>
</details>
<hr />
</div>
<div id="interaction-plot" class="section level3">
<h3><span class="header-section-number">5.2.2</span> 4.2 Interaction plot</h3>
<p>Interactions can also be viewed graphically using the function
<code>interaction.plot</code> as:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="t-test-and-anova.html#cb133-1"></a><span class="kw">interaction.plot</span>(bird<span class="op">$</span>Diet, bird<span class="op">$</span>Aquatic, bird<span class="op">$</span>logMaxAbund, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb133-2"><a href="t-test-and-anova.html#cb133-2"></a>    <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="st">&quot;log&quot;</span>[<span class="dv">10</span>] <span class="op">*</span><span class="st"> &quot;(Maximum Abundance)&quot;</span>), <span class="dt">xlab =</span> <span class="st">&quot;Diet&quot;</span>)</span></code></pre></div>
<p><img src="book-en_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<p>What do the gaps in the line for the Aquatic group mean?</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="t-test-and-anova.html#cb134-1"></a><span class="kw">table</span>(bird<span class="op">$</span>Diet, bird<span class="op">$</span>Aquatic)</span></code></pre></div>
<pre><code>##              
##                0  1
##   Insect      14  6
##   InsectVert   1  1
##   Plant        2  0
##   PlantInsect 17  1
##   Vertebrate   5  7</code></pre>
<p>The design is unbalanced; unequal observations among diet levels for
Aquatic (coded as 1) and Terrestrial (coded as 0). See advanced section
below for details on unbalanced ANOVA designs.</p>
<hr />
<p><strong>CHALLENGE 3</strong></p>
<p>Test the significance of the Aquatic factor by comparing nested models
with and without this categorical variable.</p>
<details>
<p><summary><strong>Cliquez pour voir la solution au Défi 3!</strong></summary></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="t-test-and-anova.html#cb136-1"></a><span class="kw">anova</span>(anov1, anov5)  <span class="co"># Recall: anov1 is model with only Diet as a factor</span></span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: logMaxAbund ~ Diet
## Model 2: logMaxAbund ~ Diet + Aquatic
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1     49 116.92                           
## 2     48 115.23  1    1.6878 0.7031 0.4059</code></pre>
</details>
<hr />
</div>
</div>
<div id="unbalanced-anova-advanced-section-optional" class="section level2">
<h2><span class="header-section-number">5.3</span> Unbalanced ANOVA (advanced section/ optional)</h2>
<p>One-way and two-way ANOVA enabled us to determine the effect
of categorical explanatory variables on a continuous response variable
for the case of balanced experimental designs (i.e. when all levels of
the explanatory variables contain the same number of replicates).
However, loss of experimental units over the course of an experiment, or
technical restriction of experimental designs can result in unbalanced
designs. In this case, the above-mentioned ANOVA tests lead to
misleading results related due to incorrect sum of squares calculations.
For unbalanced experimental design, ANOVA must be modified to correctly
account for the missing values of the response variable.</p>
<p><strong>A dataset is considered unbalanced when the sample sizes of two factor levels are not equal.</strong></p>
<p>The <code>birdsdiet</code> data is actually unbalanced (number of Aquatic and non-Aquatic is not equal)</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="t-test-and-anova.html#cb138-1"></a><span class="kw">table</span>(bird<span class="op">$</span>Aquatic)</span></code></pre></div>
<pre><code>## 
##  0  1 
## 39 15</code></pre>
<p>While mathematical model, statistical hypothesis and statistical
assumptions for ANOVA with unbalanced designs remain the same as for
ANOVA with balanced designs, the sum of squares calculation changes.</p>
<p>For unbalanced design, ANOVA thus test the hypothesis:</p>
<p>H<sub>0</sub>: µ<sub>1</sub> = µ<sub>2</sub> =... = µ<sub>i</sub> =... = µ<sub>n</sub><br />
H<sub>1</sub>: there is at least one µi that differs from the others.</p>
<p>Using this mathematical model:</p>
<p><span class="math inline">\(y_{ijk} = µ + A_{i} + B_{j} + A_{i}B_{j} + ε_{ijk}\)</span></p>
<p>Recall the sum of squares calculation of the ANOVA with balanced design:</p>
<p><span class="math display">\[ SS_{A} = rb\sum_{i}(\overline{y}_{i.}-\overline{y})^2 = SS(A)\]</span></p>
<p><span class="math display">\[ SS_{B} = ra \sum_{j}(\overline{y}_{.j}-\overline{y})^2 = SS(B\|A) = SS(A,B)-SS(B)\]</span></p>
<p><span class="math display">\[ SS_{AB} = r \sum{i,j,k}(\overline{y}_{..k}-\overline{y}_{.jk}-\overline{y}_{i.k})^2= SS(A,B,AB)-SS(A,B)\]</span></p>
<p>This corresponds to <em>sequential</em> sum of squares, or <strong>Type I</strong> sum of squares,
as the main effect of B is calculated after removing the main effect of
A, and the interaction effect is calculated after removing the two main
effects. <strong>Type I</strong> sum of suqares is the default type used in R. These calculations are sample size dependent as the effect of
each factor is calculated after removing the effect of the precedent
factor.</p>
<p>For unbalanced design, ANOVA results will depend on the order in which
each explanatory variable appears in the model. This can be seen by
comparing the results of the following two models:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="t-test-and-anova.html#cb140-1"></a>unb_anov1 &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Aquatic <span class="op">+</span><span class="st"> </span>Diet, <span class="dt">data =</span> bird)</span>
<span id="cb140-2"><a href="t-test-and-anova.html#cb140-2"></a>unb_anov2 &lt;-<span class="st"> </span><span class="kw">lm</span>(logMaxAbund <span class="op">~</span><span class="st"> </span>Diet <span class="op">+</span><span class="st"> </span>Aquatic, <span class="dt">data =</span> bird)</span>
<span id="cb140-3"><a href="t-test-and-anova.html#cb140-3"></a><span class="kw">anova</span>(unb_anov1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: logMaxAbund
##           Df  Sum Sq Mean Sq F value  Pr(&gt;F)  
## Aquatic    1   1.228  1.2278  0.5114 0.47798  
## Diet       4  27.531  6.8827  2.8671 0.03291 *
## Residuals 48 115.230  2.4006                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="t-test-and-anova.html#cb142-1"></a><span class="kw">anova</span>(unb_anov2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: logMaxAbund
##           Df  Sum Sq Mean Sq F value  Pr(&gt;F)  
## Diet       4  27.071  6.7677  2.8191 0.03517 *
## Aquatic    1   1.688  1.6878  0.7031 0.40591  
## Residuals 48 115.230  2.4006                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>While the same explanatory variables are used in these two models, the
ANOVA tables show different results due to the unbalanced design (i.e.
different number of observations for aquatic and non-aquatic birds).</p>
<p>A <strong>Type II</strong> sum of squares will test for the presence of a main effect after the other main effect.</p>
<p>For unbalanced designs, <em>marginal</em> sum of squares, or <strong>Type III</strong> sum of
squares is the most used. It performs calculations of main effect after removing the
effect of all other factors ensure independence from sample size
effects.</p>
<p><strong>SIf you are considering using Type II or III for your own dataset, you should read more about the subject. You can start with this <a href="https://mcfromnz.wordpress.com/2011/03/02/anova-type-iiiiii-ss-explained/">link</a></strong></p>
<p>The equation for the sum of squre <strong>Type III</strong> is:</p>
<p><span class="math display">\[SS_{A}=SS(A\|B,AB)=SS(A,B,AB)-SS(B,AB)\]</span>
<span class="math display">\[SS_{B}=SS(B\|A,AB)=SS(A,B,AB)-SS(A,AB)\]</span>
<span class="math display">\[SS_{AB}=SS(AB\|B,A)=SS(A,B,AB)-SS(B,AB)\]</span></p>
<p>In R, ANOVA with <strong>type III</strong> sum of squares can be implemented using the
<code>Anova</code> function of package <a href="https://cran.r-project.org/web/packages/car/car.pdf">car</a> and specifying “III” in the type option,
for example:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="t-test-and-anova.html#cb144-1"></a><span class="kw">library</span>(car)</span>
<span id="cb144-2"><a href="t-test-and-anova.html#cb144-2"></a><span class="kw">Anova</span>(unb_anov1, <span class="dt">type =</span> <span class="st">&quot;III&quot;</span>)</span>
<span id="cb144-3"><a href="t-test-and-anova.html#cb144-3"></a><span class="kw">Anova</span>(unb_anov2, <span class="dt">type =</span> <span class="st">&quot;III&quot;</span>)</span></code></pre></div>
<p>By comparing ANOVA tables of models with different order of explanatory
variables, users can now note that the ANOVA table results always remain
the same. Type III sum of squares thus correctly calculates the ANOVA
results by becoming independent of sample sizes.</p>
<p>After having verifying the model assumptions, results can finally be
safely interpreted.</p>

</div>
</div>
<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="linear-regression-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analysis-of-covariance-ancova.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
